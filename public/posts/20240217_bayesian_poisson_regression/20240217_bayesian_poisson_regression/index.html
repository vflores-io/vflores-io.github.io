<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Bayesian Poisson Regression with Julia and Turing.jl | Victor Flores</title>
<meta name=keywords content="Bayesian,Bayesian Regression,Poisson,Regression,Turing,Julia"><meta name=description content="Explore Bayesian Poisson regression for modeling count data with Julia and Turing.jl. This tutorial includes model setup, implementation, and performance assessment with a practical example."><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/20240217_bayesian_poisson_regression/20240217_bayesian_poisson_regression/><link crossorigin=anonymous href=/assets/css/stylesheet.min.cc305c161bc6ee4c6ba7ee115b6e10dd6be37f10696b436f93d754dee01c7e81.css integrity="sha256-zDBcFhvG7kxrp+4RW24Q3WvjfxBpa0Nvk9dU3uAcfoE=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=alternate hreflang=en href=http://localhost:1313/posts/20240217_bayesian_poisson_regression/20240217_bayesian_poisson_regression/><meta name=twitter:title content="Bayesian Poisson Regression with Julia and Turing.jl | Victor Flores"><meta name=twitter:description content="Explore Bayesian Poisson regression for modeling count data with Julia and Turing.jl. This tutorial includes model setup, implementation, and performance assessment with a practical example."><meta property="og:title" content="Bayesian Poisson Regression with Julia and Turing.jl | Victor Flores"><meta property="og:description" content="Explore Bayesian Poisson regression for modeling count data with Julia and Turing.jl. This tutorial includes model setup, implementation, and performance assessment with a practical example."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/20240217_bayesian_poisson_regression/20240217_bayesian_poisson_regression/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-17T11:57:07+08:00"><meta property="article:modified_time" content="2024-02-17T11:57:07+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Bayesian Poisson Regression with Julia and Turing.jl","item":"http://localhost:1313/posts/20240217_bayesian_poisson_regression/20240217_bayesian_poisson_regression/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Bayesian Poisson Regression with Julia and Turing.jl | Victor Flores","name":"Bayesian Poisson Regression with Julia and Turing.jl","description":"Explore Bayesian Poisson regression for modeling count data with Julia and Turing.jl. This tutorial includes model setup, implementation, and performance assessment with a practical example.","keywords":["Bayesian","Bayesian Regression","Poisson","Regression","Turing","Julia"],"wordCount":"1791","inLanguage":"en","datePublished":"2024-02-17T11:57:07+08:00","dateModified":"2024-02-17T11:57:07+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/20240217_bayesian_poisson_regression/20240217_bayesian_poisson_regression/"},"publisher":{"@type":"Organization","name":"Victor Flores","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type=text/x-mathjax-config>
        MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true
        }
        });
    </script></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Victor Flores (Alt + H)">Victor Flores</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=Tags>Tags</a></li><li><a href=http://localhost:1313/archives/ title=Archive>Archive</a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" data-no-instant accesskey=/>Search</a></li><li><a href=http://localhost:1313/about/ title=About>About</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Bayesian Poisson Regression with Julia and Turing.jl</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>February 17, 2024</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=http://localhost:1313/tags/bayesian/>Bayesian</a><a href=http://localhost:1313/tags/bayesian-regression/>Bayesian Regression</a><a href=http://localhost:1313/tags/poisson/>Poisson</a><a href=http://localhost:1313/tags/regression/>Regression</a><a href=http://localhost:1313/tags/turing/>Turing</a><a href=http://localhost:1313/tags/julia/>Julia</a></span></span></div></header><div class=post-content><hr><p>In this example, I am following the tutorials found in:</p><ul><li><a href=https://turinglang.org/dev/tutorials/07-poisson-regression/>Turing.jl - Bayesian Poisson Regression</a></li><li><a href=https://www.pymc.io/projects/examples/en/latest/generalized_linear_models/GLM-poisson-regression.html>PyMC - GLM: Poisson Regression</a></li></ul><p>Both examples show the interaction between some variables and a discrete outcome. In this case, the outcome is the number of sneezes per day (i.e. a discrete outcome) in some study subjects, and whether or not they take antihistamine medicine and whether or not they drink alcohol.</p><p>This example explores how these factors, and more specifically, the combination of these factors, affect the number of times a person sneezes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>using</span> <span class=n>CSV</span><span class=p>,</span> <span class=n>DataFrames</span><span class=p>,</span> <span class=n>Turing</span><span class=p>,</span> <span class=n>StatsPlots</span><span class=p>,</span> <span class=n>Plots</span><span class=p>,</span> <span class=n>Random</span>
</span></span><span class=line><span class=cl><span class=n>Random</span><span class=o>.</span><span class=n>seed!</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>TaskLocalRNG()
</code></pre><h2 id=collect-generate-the-data>Collect (generate) the data<a hidden class=anchor aria-hidden=true href=#collect-generate-the-data>Â¶</a></h2><p>In this example, we will generate the data in the same way as in the tutorials:</p><table><thead><tr><th style=text-align:left></th><th style=text-align:center>No Alcohol</th><th style=text-align:center>Alcohol</th></tr></thead><tbody><tr><td style=text-align:left><strong>No Meds</strong></td><td style=text-align:center>6</td><td style=text-align:center>36</td></tr><tr><td style=text-align:left><strong>Meds</strong></td><td style=text-align:center>1</td><td style=text-align:center>3</td></tr></tbody></table><p>Those values will be used to create the artificial data by generating Poisson-distributed random samples.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>theta_noalc_nomed</span> <span class=o>=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>theta_noalc_med</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>theta_alc_nomed</span> <span class=o>=</span> <span class=mi>36</span>
</span></span><span class=line><span class=cl><span class=n>theta_alc_med</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ns</span> <span class=o>=</span> <span class=mi>500</span>    <span class=c># number of samples</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># create a data frame</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>hcat</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>vcat</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>rand</span><span class=p>(</span><span class=n>Poisson</span><span class=p>(</span><span class=n>theta_noalc_med</span><span class=p>),</span> <span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>rand</span><span class=p>(</span><span class=n>Poisson</span><span class=p>(</span><span class=n>theta_alc_med</span><span class=p>),</span> <span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>rand</span><span class=p>(</span><span class=n>Poisson</span><span class=p>(</span><span class=n>theta_noalc_nomed</span><span class=p>),</span> <span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>rand</span><span class=p>(</span><span class=n>Poisson</span><span class=p>(</span><span class=n>theta_alc_nomed</span><span class=p>),</span> <span class=n>ns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>vcat</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>falses</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>trues</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>falses</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>trues</span><span class=p>(</span><span class=n>ns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>vcat</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>falses</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>falses</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>trues</span><span class=p>(</span><span class=n>ns</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>trues</span><span class=p>(</span><span class=n>ns</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span> <span class=ss>:auto</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># assign names to headers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>head_names</span> <span class=o>=</span> <span class=p>[</span><span class=ss>:n_sneezes</span><span class=p>,</span> <span class=ss>:alcohol</span><span class=p>,</span> <span class=ss>:nomeds</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sneeze_data</span> <span class=o>=</span> <span class=n>DataFrame</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>head_names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>first</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><div><div style=float:left><span>10Ã—3 DataFrame</span></div><div style=clear:both></div></div><div class=data-frame style=overflow-x:scroll><table class=data-frame style=margin-bottom:6px><thead><tr class=header><th class=rowNumber style=font-weight:700;text-align:right>Row</th><th style=text-align:left>n_sneezes</th><th style=text-align:left>alcohol</th><th style=text-align:left>nomeds</th></tr><tr class="subheader headerLastRow"><th class=rowNumber style=font-weight:700;text-align:right></th><th title=Int64 style=text-align:left>Int64</th><th title=Int64 style=text-align:left>Int64</th><th title=Int64 style=text-align:left>Int64</th></tr></thead><tbody><tr><td class=rowNumber style=font-weight:700;text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>2</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>3</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>4</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>5</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>6</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>7</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>8</td><td style=text-align:right>1</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>9</td><td style=text-align:right>2</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>10</td><td style=text-align:right>2</td><td style=text-align:right>0</td><td style=text-align:right>0</td></tr></tbody></table></div><h3 id=visualize-the-data>Visualize the data<a hidden class=anchor aria-hidden=true href=#visualize-the-data>Â¶</a></h3><p>Now that we have &ldquo;collected&rdquo; some data on the number of sneezes per day from a number of people, we visualize the data.</p><p>The way we are collecting and plotting these data sub-sets is as follows:</p><ol><li>Call the histogram function</li><li>Create a histogram of the dataframe &ldquo;sneeze_data&rdquo; we &ldquo;collected&rdquo; previously</li><li>Select a subset of that dataframe</li><li>All the rows of the columns where alcohol is <code>false</code> i.e. 0 AND all the rows where no medicine was taken is also <code>false</code></li><li>All the rows of the columns where alcohol is <code>false</code> AND all the rows of where medicine is <code>true</code></li><li>&mldr; and so on</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># create separate histograms for each case</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>histogram</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>[(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:alcohol</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>.&amp;</span> <span class=p>(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:nomeds</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>0</span><span class=p>),</span> <span class=ss>:n_sneezes</span><span class=p>];</span> <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;No alcohol + No Meds&#34;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s>&#34;People Count&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>histogram</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>[(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:alcohol</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>1</span><span class=p>)</span> <span class=o>.&amp;</span> <span class=p>(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:nomeds</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>0</span><span class=p>),</span> <span class=ss>:n_sneezes</span><span class=p>];</span> <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;No alcohol + Meds&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p3</span> <span class=o>=</span> <span class=n>histogram</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>[(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:alcohol</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>.&amp;</span> <span class=p>(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:nomeds</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>1</span><span class=p>),</span> <span class=ss>:n_sneezes</span><span class=p>];</span> <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Alcohol + No Meds&#34;</span><span class=p>,</span> <span class=n>xlabel</span> <span class=o>=</span> <span class=s>&#34;Sneezes/Day&#34;</span><span class=p>,</span> <span class=n>ylabel</span><span class=o>=</span><span class=s>&#34;People Count&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p4</span> <span class=o>=</span> <span class=n>histogram</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>[(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:alcohol</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>1</span><span class=p>)</span> <span class=o>.&amp;</span> <span class=p>(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>:</span><span class=p>,</span><span class=ss>:nomeds</span><span class=p>]</span> <span class=o>.==</span> <span class=mi>1</span><span class=p>),</span> <span class=ss>:n_sneezes</span><span class=p>];</span> <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Alcohol + Meds&#34;</span><span class=p>,</span> <span class=n>xlabel</span> <span class=o>=</span> <span class=s>&#34;Sneezes/Day&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plot</span><span class=p>(</span><span class=n>p1</span><span class=p>,</span> <span class=n>p2</span><span class=p>,</span> <span class=n>p3</span><span class=p>,</span> <span class=n>p4</span><span class=p>;</span> <span class=n>layout</span><span class=o>=</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span> <span class=n>legend</span> <span class=o>=</span> <span class=nb>false</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/20240217_Bayesian_Poisson_Regression/output_5_0.svg type alt=svg></p><h3 id=interpreting-the-data>Interpreting the data<a hidden class=anchor aria-hidden=true href=#interpreting-the-data>Â¶</a></h3><p>The histograms show that the data from the &ldquo;study&rdquo; resembles a Poisson distribution (as mentioned in the PyMC tutorial, this is obvious, because that&rsquo;s how the data is generated!). Furthermore, the data is telling us something:</p><ul><li>Looking at the plot for &ldquo;no alcohol and medicine&rdquo; it is clear that most people reported very few sneezes; notice how the histogram skews towards large counts (of people) for very few sneezes</li><li>On the other hand, notice how the &ldquo;alcohol and <em>no</em> medicine&rdquo; seems to tell us that many reported somewhere around 35 sneezes per day</li></ul><p>Again, we can start thinking of a pattern just by looking at the data, and it seems like the data is telling us that if you don&rsquo;t drink alcohol and take antihistamines, you are less likely to be sneezing around than if you drink alcohol and don&rsquo;t take any allergy meds. Makes sense, right?</p><h2 id=model>Model<a hidden class=anchor aria-hidden=true href=#model>Â¶</a></h2><p>We established that the data looks like it could be modelled as a Poisson distribution. Thus, we can define our probabilistic model as follows:</p><p>$$Y_{obs} \sim Poisson(\lambda)$$</p><p>$$\log(\lambda) = \theta&rsquo;\mathbf{x} = \alpha + \beta&rsquo; \mathbf{x}$$</p><p>What the above means is that we assume that the observed data outcomes, i.e., the number of sneezes per day, follow a Poisson distribution, which is a discrete probability distribution that models the number of events that occur in a fixed interval of time or space. The rate or intensity of the events, $\lambda$, depends on the predictor variables (the input data) $\mathcal{x}$, such as the season, the temperature, or, in our case, whether a person ingested alcohol and whether the person took antihistamines.</p><p>The linear predictor $\theta&rsquo; \mathcal{x}$ is the function that links the predictor variables to the rate parameter, where $\theta = {\alpha, \beta&rsquo;}$ are the parameters of the model.</p><p>Looking at the structure of the linear relationship between the paramters of the model, and the predictors:</p><p>$$\log(\lambda) = \alpha + \beta&rsquo; \mathcal{x}$$</p><p>we can understand that the parameter $\alpha$ is the intercept, which is the expected number of sneezes when all the predictor variables are zero. The parameter $\beta&rsquo;$ is a vector of coefficients, which measure the effect of each predictor variable $\mathcal{x}$ on the number of sneezes. The log link function ensures that the rate parameter $\lambda$ is always positive and allows for multiplicative effects of the predictor variables on the response variable.</p><h3 id=define-the-model-with-turingjl>Define the model with <code>Turing.jl</code><a hidden class=anchor aria-hidden=true href=#define-the-model-with-turingjl>Â¶</a></h3><p>Now that we know how we are modeling our data, we use the package <code>Turing.jl</code> to define the model. <code>Turing.jl</code> is a tool that helps us write models in Julia and find the best parameters for them.</p><p>The model has two parts: the prior and the likelihood. The prior is what we think or guess about the parameters before we see the data. The likelihood is how likely the data is under the parameters. The parameters are the numbers that control the model, such as the rate of sneezes.</p><p>We use the Poisson distribution for the likelihood, because it is good for counting things, like sneezes. The Poisson distribution has one parameter, the rate of sneezes. The higher the rate, the more sneezes we expect.</p><p>We use any distribution for the prior, depending on how much we know about the parameters. If we know nothing, we use a flat prior, which does not favor any value. The prior affects the final answer, because it is our starting point.</p><p>We use Bayesâ€™ theorem to combine the prior and the likelihood and get the final answer. The final answer is the posterior, which is what we believe about the parameters after we see the data. The posterior is the best fit for the model and the data.</p><p><strong>Let&rsquo;s crank up the Bayes!</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=nd>@model</span> <span class=k>function</span> <span class=n>poisson</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c># define the priors</span>
</span></span><span class=line><span class=cl>		<span class=n>alpha</span> <span class=o>~</span> <span class=n>Normal</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>alcohol</span> <span class=o>~</span> <span class=n>Normal</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>nomeds</span> <span class=o>~</span> <span class=n>Normal</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=c># alc_med ~ Normal(0,1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c># define the likelihood</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=n>i</span> <span class=k>in</span> <span class=mi>1</span><span class=o>:</span><span class=n>length</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	        <span class=n>log_lambda</span> <span class=o>=</span> <span class=n>alpha</span> <span class=o>+</span> <span class=n>alcohol</span> <span class=o>*</span> <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>nomeds</span> <span class=o>*</span> <span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> 
</span></span><span class=line><span class=cl>	        <span class=n>lambda</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>log_lambda</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	        <span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>~</span> <span class=n>Poisson</span><span class=p>(</span><span class=n>lambda</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	    <span class=k>end</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span></code></pre></div><pre><code>poisson (generic function with 2 methods)
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># pass the data to the model function</span>
</span></span><span class=line><span class=cl>	<span class=c># pass the predictor data as a Matrix for efficiency</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>poisson</span><span class=p>(</span><span class=kt>Matrix</span><span class=p>(</span><span class=n>sneeze_data</span><span class=p>[</span><span class=o>!</span><span class=p>,[</span><span class=ss>:alcohol</span><span class=p>,</span> <span class=ss>:nomeds</span><span class=p>]</span> <span class=p>]),</span> <span class=n>sneeze_data</span><span class=p>[</span><span class=o>!</span><span class=p>,</span> <span class=ss>:n_sneezes</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># select the sampler</span>
</span></span><span class=line><span class=cl><span class=n>sampler</span> <span class=o>=</span> <span class=n>NUTS</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># define the number of sampler</span>
</span></span><span class=line><span class=cl><span class=n>samples</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># set number of chains</span>
</span></span><span class=line><span class=cl><span class=n>num_chains</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=c># crank up the Bayes!</span>
</span></span><span class=line><span class=cl><span class=n>chain</span> <span class=o>=</span> <span class=n>sample</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>sampler</span><span class=p>,</span> <span class=n>MCMCThreads</span><span class=p>(),</span> <span class=n>samples</span><span class=p>,</span> <span class=n>num_chains</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.00625
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.0125
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.00625
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.0125
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.0125
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.00625
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.00625
[36m[1mâ”Œ [22m[39m[36m[1mInfo: [22m[39mFound initial step size
[36m[1mâ”” [22m[39m  Ïµ = 0.0125
[32mSampling (8 threads): 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| Time: 0:00:00[39m





Chains MCMC chain (1000Ã—15Ã—8 Array{Float64, 3}):

Iterations        = 501:1:1500
Number of chains  = 8
Samples per chain = 1000
Wall duration     = 13.66 seconds
Compute duration  = 100.67 seconds
parameters        = alpha, alcohol, nomeds
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
 [1m parameters [0m [1m    mean [0m [1m     std [0m [1m    mcse [0m [1m  ess_bulk [0m [1m  ess_tail [0m [1m    rhat [0m [1m[0m â‹¯
 [90m     Symbol [0m [90m Float64 [0m [90m Float64 [0m [90m Float64 [0m [90m   Float64 [0m [90m   Float64 [0m [90m Float64 [0m [90m[0m â‹¯

       alpha   -0.5025    0.0277    0.0005   2943.5608   2841.2874    1.0030   â‹¯
     alcohol    1.7333    0.0186    0.0003   3801.1996   3652.2403    1.0022   â‹¯
      nomeds    2.3348    0.0236    0.0004   2901.3750   3410.6453    1.0020   â‹¯
[36m                                                                1 column omitted[0m

Quantiles
 [1m parameters [0m [1m    2.5% [0m [1m   25.0% [0m [1m   50.0% [0m [1m   75.0% [0m [1m   97.5% [0m
 [90m     Symbol [0m [90m Float64 [0m [90m Float64 [0m [90m Float64 [0m [90m Float64 [0m [90m Float64 [0m

       alpha   -0.5568   -0.5212   -0.5023   -0.4839   -0.4486
     alcohol    1.6974    1.7205    1.7331    1.7458    1.7698
      nomeds    2.2891    2.3189    2.3346    2.3506    2.3824
</code></pre><p><strong>NOTE:</strong> The above routine employs the MCMCThreads method to sample multiple chains. However, in order to implement this, one needs to change the environment variables for the number of threads Julia can use. These two threads might shed some light as to how to achieve this:</p><ol><li><a href=https://docs.julialang.org/en/v1/manual/multi-threading/#man-multithreading>https://docs.julialang.org/en/v1/manual/multi-threading/#man-multithreading</a></li><li><a href=https://discourse.julialang.org/t/julia-num-threads-in-vs-code-windows-10-wsl/28794>https://discourse.julialang.org/t/julia-num-threads-in-vs-code-windows-10-wsl/28794</a></li></ol><p>Of course, if you don&rsquo;t want to bother, then just change the last two functional lines in the cell above so that they read:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl>	<span class=c># set number of chains - comment this out:</span>
</span></span><span class=line><span class=cl>	<span class=c># num_chains = 8</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c># crank up the Bayes! - delete MCMCThreads() and num_chains</span>
</span></span><span class=line><span class=cl>	<span class=n>chain</span> <span class=o>=</span> <span class=n>sample</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>sampler</span><span class=p>,</span> <span class=n>samples</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=visualize-the-results>Visualize the results<a hidden class=anchor aria-hidden=true href=#visualize-the-results>Â¶</a></h3><p>We can see above that we have obtained a sample pool of the posterior distribution of the parameters. This is what we were looking for. What this means is that now we have a posterior distribution (in the form of a sample pool), which we can also summarize with summary statistics.</p><p>Let&rsquo;s look at the diagnostics plots and the summary statistics.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>plot</span><span class=p>(</span><span class=n>chain</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/20240217_Bayesian_Poisson_Regression/output_13_0.svg type alt=svg></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>DataFrame</span><span class=p>(</span><span class=n>summarystats</span><span class=p>(</span><span class=n>chain</span><span class=p>))</span>
</span></span></code></pre></div><div><div style=float:left><span>3Ã—8 DataFrame</span></div><div style=clear:both></div></div><div class=data-frame style=overflow-x:scroll><table class=data-frame style=margin-bottom:6px><thead><tr class=header><th class=rowNumber style=font-weight:700;text-align:right>Row</th><th style=text-align:left>parameters</th><th style=text-align:left>mean</th><th style=text-align:left>std</th><th style=text-align:left>mcse</th><th style=text-align:left>ess_bulk</th><th style=text-align:left>ess_tail</th><th style=text-align:left>rhat</th><th style=text-align:left>ess_per_sec</th></tr><tr class="subheader headerLastRow"><th class=rowNumber style=font-weight:700;text-align:right></th><th title=Symbol style=text-align:left>Symbol</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th><th title=Float64 style=text-align:left>Float64</th></tr></thead><tbody><tr><td class=rowNumber style=font-weight:700;text-align:right>1</td><td style=text-align:left>alpha</td><td style=text-align:right>-0.502519</td><td style=text-align:right>0.0276553</td><td style=text-align:right>0.000511069</td><td style=text-align:right>2943.56</td><td style=text-align:right>2841.29</td><td style=text-align:right>1.00298</td><td style=text-align:right>29.2397</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>2</td><td style=text-align:left>alcohol</td><td style=text-align:right>1.7333</td><td style=text-align:right>0.0186097</td><td style=text-align:right>0.000301611</td><td style=text-align:right>3801.2</td><td style=text-align:right>3652.24</td><td style=text-align:right>1.00224</td><td style=text-align:right>37.759</td></tr><tr><td class=rowNumber style=font-weight:700;text-align:right>3</td><td style=text-align:left>nomeds</td><td style=text-align:right>2.3348</td><td style=text-align:right>0.0236269</td><td style=text-align:right>0.000436385</td><td style=text-align:right>2901.38</td><td style=text-align:right>3410.65</td><td style=text-align:right>1.00197</td><td style=text-align:right>28.8207</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># taking the first chain</span>
</span></span><span class=line><span class=cl><span class=n>c1</span> <span class=o>=</span> <span class=n>chain</span><span class=p>[</span><span class=o>:</span><span class=p>,</span> <span class=o>:</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Calculating the exponentiated means</span>
</span></span><span class=line><span class=cl><span class=n>b0_exp</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>mean</span><span class=p>(</span><span class=n>c1</span><span class=p>[</span><span class=ss>:alpha</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>b1_exp</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>mean</span><span class=p>(</span><span class=n>c1</span><span class=p>[</span><span class=ss>:alcohol</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>b2_exp</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>mean</span><span class=p>(</span><span class=n>c1</span><span class=p>[</span><span class=ss>:nomeds</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=p>(</span><span class=s>&#34;The exponent of the mean of the weights (or coefficients) are: </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=p>(</span><span class=s>&#34;b0: &#34;</span><span class=p>,</span> <span class=n>b0_exp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=p>(</span><span class=s>&#34;b1: &#34;</span><span class=p>,</span> <span class=n>b1_exp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=p>(</span><span class=s>&#34;b2: &#34;</span><span class=p>,</span> <span class=n>b2_exp</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>The exponent of the mean of the weights (or coefficients) are: 

b0: 0.604415461752317
b1: 5.658573583760772
b2: 10.342642711232362
</code></pre><p>Notice how we are <strong>not</strong> recovering the original $\lambda$ values that were used to create this data set, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl>	<span class=n>theta_noalc_nomed</span> <span class=o>=</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>	<span class=n>theta_noalc_med</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=n>theta_alc_nomed</span> <span class=o>=</span> <span class=mi>36</span>
</span></span><span class=line><span class=cl>	<span class=n>theta_alc_med</span> <span class=o>=</span> <span class=mi>3</span>
</span></span></code></pre></div><p>Instead, we are recovering <em>the parameters of the linear function</em>, in other words, $\theta = {\alpha, \beta&rsquo;}$ in the linear relation:</p><p>$$\log(\lambda) = \alpha + \beta_1 x_{alc} + \beta_2 x_{meds}$$</p><p>where $x_{(\cdot)}$ represents the binary variable of whether the subject took alcohol/medicine or not.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>Â¶</a></h2><p>This tutorial shows how to perform Bayesian inference on <em>discrete</em> data, e.g. the record of how many sneezes per day a group of people had, and classified according to their alcohol and medication consumption.</p><p>In real-world scenarios, we would obviously not know the parameter values, since this is precisely what we want to find out by incorporating whatever we knew about them into what we observed.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=http://localhost:1313/posts/20240222_bayesian_time_series_analysis/20240222_bayesian_time_series_analysis/><span class=title><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Bayesian Time Series Analysis with Julia and Turing.jl</span>
</a><a class=next href=http://localhost:1313/posts/20240109_bayesian-logistic-regression/20240109_bayesian-logistic-regression/><span class=title>Next Page&nbsp;<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Bayesian Logistic Regression with Julia and Turing.jl</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Victor Flores</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>