<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Election Data Dashboard Pt. 2: Dashboard with Dash | Victor Flores</title>
<meta name=keywords content="Data Analysis,dash,Data Wrangling,Data Cleaning,Dashboard"><meta name=description content="The cleaned data is loadsed and the plot generating functions are refactored here. Then a dashboard is created using dash."><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/20240509_election_dash_part_2-dashboard/20240509_election_dash_part_2-dashboard/><link crossorigin=anonymous href=/assets/css/stylesheet.min.cc305c161bc6ee4c6ba7ee115b6e10dd6be37f10696b436f93d754dee01c7e81.css integrity="sha256-zDBcFhvG7kxrp+4RW24Q3WvjfxBpa0Nvk9dU3uAcfoE=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=alternate hreflang=en href=http://localhost:1313/posts/20240509_election_dash_part_2-dashboard/20240509_election_dash_part_2-dashboard/><meta name=twitter:title content="Election Data Dashboard Pt. 2: Dashboard with Dash | Victor Flores"><meta name=twitter:description content="The cleaned data is loadsed and the plot generating functions are refactored here. Then a dashboard is created using dash."><meta property="og:title" content="Election Data Dashboard Pt. 2: Dashboard with Dash | Victor Flores"><meta property="og:description" content="The cleaned data is loadsed and the plot generating functions are refactored here. Then a dashboard is created using dash."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/20240509_election_dash_part_2-dashboard/20240509_election_dash_part_2-dashboard/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-09T11:57:07+08:00"><meta property="article:modified_time" content="2024-05-09T11:57:07+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Election Data Dashboard Pt. 2: Dashboard with Dash","item":"http://localhost:1313/posts/20240509_election_dash_part_2-dashboard/20240509_election_dash_part_2-dashboard/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Election Data Dashboard Pt. 2: Dashboard with Dash | Victor Flores","name":"Election Data Dashboard Pt. 2: Dashboard with Dash","description":"The cleaned data is loadsed and the plot generating functions are refactored here. Then a dashboard is created using dash.","keywords":["Data Analysis","dash","Data Wrangling","Data Cleaning","Dashboard"],"wordCount":"1949","inLanguage":"en","datePublished":"2024-05-09T11:57:07+08:00","dateModified":"2024-05-09T11:57:07+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/20240509_election_dash_part_2-dashboard/20240509_election_dash_part_2-dashboard/"},"publisher":{"@type":"Organization","name":"Victor Flores","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type=text/x-mathjax-config>
        MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true
        }
        });
    </script></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Victor Flores (Alt + H)">Victor Flores</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=Tags>Tags</a></li><li><a href=http://localhost:1313/archives/ title=Archive>Archive</a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" data-no-instant accesskey=/>Search</a></li><li><a href=http://localhost:1313/about/ title=About>About</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Election Data Dashboard Pt. 2: Dashboard with Dash</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>May 9, 2024</span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=http://localhost:1313/tags/data-analysis/>Data Analysis</a><a href=http://localhost:1313/tags/dash/>Dash</a><a href=http://localhost:1313/tags/data-wrangling/>Data Wrangling</a><a href=http://localhost:1313/tags/data-cleaning/>Data Cleaning</a><a href=http://localhost:1313/tags/dashboard/>Dashboard</a></span></span></div></header><div class=post-content><hr><h3 id=creating-the-dashboard-using-dash>Creating the Dashboard using <code>dash</code><a hidden class=anchor aria-hidden=true href=#creating-the-dashboard-using-dash>Â¶</a></h3><p>The cleaned data is loadsed and the plot generating functions are refactored here. Then a dashboard is created using dash.</p><p>This dashboard is deployed (at the time of writing this post) here:</p><p><a href=https://elections-dash.onrender.com/>https://elections-dash.onrender.com/</a></p><p>Here are some screenshots of the final dashboard, in case the deployed dashboard takes took long to load or is unavailable:</p><p><img loading=lazy src=/images/20240509_election_dash_part_2-dashboard/elections_dashboard_cap01.png type alt=png></p><p><img loading=lazy src=/images/20240509_election_dash_part_2-dashboard/elections_dashboard_cap02.png type alt=png></p><p><img loading=lazy src=/images/20240509_election_dash_part_2-dashboard/elections_dashboard_cap03.png type alt=png></p><p>Here is the full code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>dash</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dash</span> <span class=kn>import</span> <span class=n>Dash</span><span class=p>,</span> <span class=n>dcc</span><span class=p>,</span> <span class=n>html</span><span class=p>,</span> <span class=n>Input</span><span class=p>,</span> <span class=n>Output</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>plotly.express</span> <span class=k>as</span> <span class=nn>px</span> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>dash_bootstrap_components</span> <span class=k>as</span> <span class=nn>dbc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generate variables and constants</span>
</span></span><span class=line><span class=cl><span class=n>election_years</span> <span class=o>=</span> <span class=p>[</span><span class=n>year</span> <span class=k>for</span> <span class=n>year</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2009</span><span class=p>,</span> <span class=mi>2022</span><span class=p>,</span> <span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=c1># Mapping each election year to its corresponding dataframe</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>distribute_alliance_votes</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>alliances</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ensure that party columns exist in the dataframe, add them if the do not</span>
</span></span><span class=line><span class=cl>    <span class=n>all_parties</span> <span class=o>=</span> <span class=nb>set</span><span class=p>(</span><span class=n>party</span> <span class=k>for</span> <span class=n>parties</span> <span class=ow>in</span> <span class=n>alliances</span><span class=o>.</span><span class=n>values</span><span class=p>()</span> <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>parties</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>all_parties</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>party</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=p>[</span><span class=n>party</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># distribute the votes from each alliance to the respective parties</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>alliance</span><span class=p>,</span> <span class=n>parties</span> <span class=ow>in</span> <span class=n>alliances</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>alliance</span> <span class=ow>in</span> <span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>split_votes</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>alliance</span><span class=p>]</span> <span class=o>/</span> <span class=nb>len</span><span class=p>(</span><span class=n>parties</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>parties</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>df</span><span class=p>[</span><span class=n>party</span><span class=p>]</span> <span class=o>+=</span> <span class=n>split_votes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># optionally remove the alliance columns</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>alliances</span><span class=o>.</span><span class=n>keys</span><span class=p>()),</span> <span class=n>inplace</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>errors</span> <span class=o>=</span> <span class=s1>&#39;ignore&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main_parties</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN&#39;</span><span class=p>:</span> <span class=s1>&#39;PAN&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRI&#39;</span><span class=p>:</span> <span class=s1>&#39;PRI&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRD&#39;</span><span class=p>:</span> <span class=s1>&#39;PRD&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PVEM&#39;</span><span class=p>:</span> <span class=s1>&#39;PVEM&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PT&#39;</span><span class=p>:</span> <span class=s1>&#39;PT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;MC&#39;</span><span class=p>:</span> <span class=s1>&#39;MC&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;MORENA&#39;</span><span class=p>:</span> <span class=s1>&#39;MORENA&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;NVA_ALIANZA&#39;</span><span class=p>:</span> <span class=s1>&#39;NVA_ALIANZA&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PSD&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PSD&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRIMERO_MEXICO&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRIMERO_MEXICO&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;SALVEMOS_MEXICO&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;SALVEMOS_MEXICO&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PH&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PH&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ES&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;ES&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;NA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;NA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PES&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PES&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;RSP&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;RSP&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;FXM&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;FXM&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1># Add more as needed for each unique party or alliance...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>alliance_votes_mapping</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_NVA_ALIANZA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;NVA_ALIANZA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_PRD&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;PRD&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRI_PVEM&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRI&#39;</span><span class=p>,</span> <span class=s1>&#39;PVEM&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRI_NA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRI&#39;</span><span class=p>,</span> <span class=s1>&#39;NA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRI_PVEM_NA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRI&#39;</span><span class=p>,</span> <span class=s1>&#39;PVEM&#39;</span><span class=p>,</span> <span class=s1>&#39;NA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_PRI_PRD&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;PRI&#39;</span><span class=p>,</span> <span class=s1>&#39;PRD&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_PRI&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;PRI&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRI_PRD&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRI&#39;</span><span class=p>,</span> <span class=s1>&#39;PRD&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRD_PT&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRD&#39;</span><span class=p>,</span> <span class=s1>&#39;PT&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PVEM_NA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PVEM&#39;</span><span class=p>,</span> <span class=s1>&#39;NA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PVEM_PT&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PVEM&#39;</span><span class=p>,</span> <span class=s1>&#39;PT&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PT_ES&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;ES&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRD_PT_MC&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRD&#39;</span><span class=p>,</span> <span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;MC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PRD_MC&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PRD&#39;</span><span class=p>,</span> <span class=s1>&#39;MC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PT_MC&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;MC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_PRD_MC&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;PRD&#39;</span><span class=p>,</span> <span class=s1>&#39;MC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PAN_MC&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PAN&#39;</span><span class=p>,</span> <span class=s1>&#39;MC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;MORENA_ES&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;MORENA&#39;</span><span class=p>,</span> <span class=s1>&#39;ES&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PT_MORENA_ES&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;MORENA&#39;</span><span class=p>,</span> <span class=s1>&#39;ES&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PT_MORENA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;MORENA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PVEM_PT_MORENA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PVEM&#39;</span><span class=p>,</span> <span class=s1>&#39;PT&#39;</span><span class=p>,</span> <span class=s1>&#39;MORENA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PVEM_MORENA&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;PVEM&#39;</span><span class=p>,</span> <span class=s1>&#39;MORENA&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1># Add any other specific alliances as needed</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># load data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># URL of the GeoJSON file on GitHub</span>
</span></span><span class=line><span class=cl><span class=n>geojson_url</span> <span class=o>=</span> <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/qroo_geojson_2022.json&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Fetch the GeoJSON data</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>geojson_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>geojson_data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_ln_sx_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_lista_nominal_sexo.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_ln_age_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_lista_nominal_edad.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>csv_urls</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_results_2009.csv&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_results_2012.csv&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_results_2015.csv&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_results_2018.csv&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;https://raw.githubusercontent.com/vflores-io/elections_dash/main/data/cleaned_results_2021.csv&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Add more URLs as needed</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Load each CSV file into a DataFrame </span>
</span></span><span class=line><span class=cl><span class=n>df_re_2009_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_urls</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2012_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_urls</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2015_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_urls</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2018_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_urls</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2021_qroo</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>csv_urls</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_re_2009_qroo</span> <span class=o>=</span> <span class=n>distribute_alliance_votes</span><span class=p>(</span><span class=n>df_re_2009_qroo</span><span class=p>,</span> <span class=n>alliance_votes_mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2012_qroo</span> <span class=o>=</span> <span class=n>distribute_alliance_votes</span><span class=p>(</span><span class=n>df_re_2012_qroo</span><span class=p>,</span> <span class=n>alliance_votes_mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2015_qroo</span> <span class=o>=</span> <span class=n>distribute_alliance_votes</span><span class=p>(</span><span class=n>df_re_2015_qroo</span><span class=p>,</span> <span class=n>alliance_votes_mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2018_qroo</span> <span class=o>=</span> <span class=n>distribute_alliance_votes</span><span class=p>(</span><span class=n>df_re_2018_qroo</span><span class=p>,</span> <span class=n>alliance_votes_mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_re_2021_qroo</span> <span class=o>=</span> <span class=n>distribute_alliance_votes</span><span class=p>(</span><span class=n>df_re_2021_qroo</span><span class=p>,</span> <span class=n>alliance_votes_mapping</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_re_all_years</span> <span class=o>=</span> <span class=p>[</span><span class=n>df_re_2009_qroo</span><span class=p>,</span> <span class=n>df_re_2012_qroo</span><span class=p>,</span> <span class=n>df_re_2015_qroo</span><span class=p>,</span> <span class=n>df_re_2018_qroo</span><span class=p>,</span> <span class=n>df_re_2021_qroo</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_dict</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=mi>2009</span><span class=p>:</span> <span class=n>df_re_2009_qroo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>2012</span><span class=p>:</span> <span class=n>df_re_2012_qroo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>2015</span><span class=p>:</span> <span class=n>df_re_2015_qroo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>2018</span><span class=p>:</span> <span class=n>df_re_2018_qroo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=mi>2021</span><span class=p>:</span> <span class=n>df_re_2021_qroo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_total_bar_plot</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Lista Hombres&#39;</span><span class=p>:</span> <span class=s1>&#39;Registered Men&#39;</span><span class=p>,</span> <span class=s1>&#39;Lista Mujeres&#39;</span><span class=p>:</span> <span class=s1>&#39;Registered Women&#39;</span><span class=p>,</span> <span class=s1>&#39;Lista Nominal&#39;</span><span class=p>:</span> <span class=s1>&#39;Total Registered&#39;</span><span class=p>},</span> <span class=n>inplace</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># group data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df_ln_qroo_totals</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>])[[</span><span class=s1>&#39;Registered Men&#39;</span><span class=p>,</span> <span class=s1>&#39;Registered Women&#39;</span><span class=p>,</span> <span class=s1>&#39;Total Registered&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig_bar_totals</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>bar</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_ln_qroo_totals</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Registered Men&#39;</span><span class=p>,</span> <span class=s1>&#39;Registered Women&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>labels</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=s1>&#39;Lista Nominal&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;variable&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>},</span> 
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Registered Voters per Municipality&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color_discrete_sequence</span><span class=o>=</span><span class=n>px</span><span class=o>.</span><span class=n>colors</span><span class=o>.</span><span class=n>qualitative</span><span class=o>.</span><span class=n>T10</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># make a dictionary for abbreviated municipality names</span>
</span></span><span class=line><span class=cl>    <span class=n>abb_mun_dict</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;BACALAR&#39;</span><span class=p>:</span> <span class=s1>&#39;BCL&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;BENITO JUAREZ&#39;</span><span class=p>:</span> <span class=s1>&#39;BJ&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;COZUMEL&#39;</span><span class=p>:</span> <span class=s1>&#39;CZ&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;FELIPE CARRILLO PUERTO&#39;</span><span class=p>:</span> <span class=s1>&#39;FCP&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;ISLA MUJERES&#39;</span><span class=p>:</span> <span class=s1>&#39;IM&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;JOSE MARIA MORELOS&#39;</span><span class=p>:</span> <span class=s1>&#39;JMM&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;LAZARO CARDENAS&#39;</span><span class=p>:</span> <span class=s1>&#39;LC&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;OTHON P. BLANCO&#39;</span><span class=p>:</span> <span class=s1>&#39;OPB&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;PUERTO MORELOS&#39;</span><span class=p>:</span> <span class=s1>&#39;PM&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;SOLIDARIDAD&#39;</span><span class=p>:</span> <span class=s1>&#39;SLD&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;TULUM&#39;</span><span class=p>:</span> <span class=s1>&#39;TLM&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig_bar_totals</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>xaxis</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>tickvals</span> <span class=o>=</span> <span class=n>df_ln_qroo_totals</span><span class=p>[</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>],</span>  <span class=c1># Original names</span>
</span></span><span class=line><span class=cl>            <span class=n>ticktext</span> <span class=o>=</span> <span class=p>[</span><span class=n>abb_mun_dict</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span> <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span>  <span class=n>df_ln_qroo_totals</span><span class=p>[</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>]]</span>  <span class=c1># Abbreviated names</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>yaxis</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>title</span> <span class=o>=</span> <span class=s1>&#39;Registered Voters&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>plot_bgcolor</span> <span class=o>=</span> <span class=s1>&#39;rgba(0,0,0,0)&#39;</span><span class=p>,</span> <span class=c1># transparent background</span>
</span></span><span class=line><span class=cl>        <span class=n>uniformtext_minsize</span> <span class=o>=</span> <span class=mi>8</span><span class=p>,</span>  <span class=c1># ensure text size is legible</span>
</span></span><span class=line><span class=cl>        <span class=n>uniformtext_mode</span> <span class=o>=</span> <span class=s1>&#39;hide&#39;</span><span class=p>,</span> <span class=c1># hide text if it doesn&#39;t fit</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig_bar_totals</span><span class=o>.</span><span class=n>update_traces</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>hoverinfo</span><span class=o>=</span><span class=s1>&#39;x+y&#39;</span><span class=p>,</span>  <span class=c1># Show the municipio name and the count on hover</span>
</span></span><span class=line><span class=cl>        <span class=n>hovertemplate</span><span class=o>=</span><span class=s2>&#34;&lt;b&gt;%</span><span class=si>{x}</span><span class=s2>&lt;/b&gt;&lt;br&gt;Total: %</span><span class=si>{y}</span><span class=s2>&lt;extra&gt;&lt;/extra&gt;&#34;</span>  <span class=c1># Custom hover template</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig_bar_totals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_total_choropleth</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>geojson</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>df_ln_qroo_totals</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>([</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>])[[</span><span class=s1>&#39;Lista Nominal&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ochre_scale</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>0.0</span><span class=p>,</span> <span class=s1>&#39;#4c78c8&#39;</span><span class=p>],</span>  <span class=c1># Blue</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>1.0</span><span class=p>,</span> <span class=s1>&#39;#f58518&#39;</span><span class=p>],</span>  <span class=c1># Light ochre (yellow)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig_choropleth_totals</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>choropleth</span><span class=p>(</span><span class=n>df_ln_qroo_totals</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>geojson</span><span class=o>=</span><span class=n>geojson</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>locations</span><span class=o>=</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                                <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Lista Nominal&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>featureidkey</span><span class=o>=</span><span class=s2>&#34;properties.NOMGEO&#34;</span><span class=p>,</span>  <span class=c1># Adjust based on your GeoJSON properties</span>
</span></span><span class=line><span class=cl>                                <span class=n>projection</span><span class=o>=</span><span class=s2>&#34;mercator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>color_continuous_scale</span><span class=o>=</span><span class=n>ochre_scale</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Registered Voters per Municipality&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fig_choropleth_totals</span><span class=o>.</span><span class=n>update_geos</span><span class=p>(</span><span class=n>fitbounds</span><span class=o>=</span><span class=s2>&#34;locations&#34;</span><span class=p>,</span> <span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>fig_choropleth_totals</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>coloraxis_colorbar</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>title</span> <span class=o>=</span> <span class=s1>&#39;Total Registered Voters&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>orientation</span><span class=o>=</span> <span class=s1>&#39;h&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>xanchor</span> <span class=o>=</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>thickness</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>len</span> <span class=o>=</span> <span class=mf>0.65</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>                      
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig_choropleth_totals</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#--------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_age_choropleth</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>geojson</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Aggregate data by MUNICIPIO</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Determine the predominant age range for each municipality</span>
</span></span><span class=line><span class=cl>    <span class=c1># age_groups = df_grouped.columns[11:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>age_groups</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Men 18&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 18&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 18&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 19&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 19&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 19&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Men 20-24&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 20-24&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 20-24&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 25-29&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 25-29&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 25-29&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Men 30-34&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 30-34&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 30-34&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 35-39&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 35-39&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 35-39&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Men 40-44&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 40-44&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 40-44&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 45-49&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 45-49&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 45-49&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Men 50-54&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 50-54&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 50-54&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 55-59&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 55-59&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 55-59&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s1>&#39;Men 60-64&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 60-64&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 60-64&#39;</span><span class=p>,</span> <span class=s1>&#39;Men 65+&#39;</span><span class=p>,</span> <span class=s1>&#39;Women 65+&#39;</span><span class=p>,</span> <span class=s1>&#39;Non-Binary 65+&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Rename the columns from the 12th column onwards</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>df_grouped</span><span class=o>.</span><span class=n>columns</span><span class=p>[:</span><span class=mi>11</span><span class=p>])</span> <span class=o>+</span> <span class=n>age_groups</span><span class=p>[:</span><span class=nb>len</span><span class=p>(</span><span class=n>df_grouped</span><span class=o>.</span><span class=n>columns</span><span class=p>)</span> <span class=o>-</span> <span class=mi>11</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;Predominant Age and Gender Group&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_grouped</span><span class=p>[</span><span class=n>age_groups</span><span class=p>]</span><span class=o>.</span><span class=n>idxmax</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># when summing, pandas also concatenates the strings in &#34;NOMBRE ENTIDAD&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># so do some housekeeping</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span><span class=o>.</span><span class=n>drop</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;NOMBRE ENTIDAD&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Assuming `geojson` is your GeoJSON object for the municipalities</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>choropleth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_grouped</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>geojson</span><span class=o>=</span><span class=n>geojson</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>locations</span><span class=o>=</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Predominant Age and Gender Group&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>featureidkey</span><span class=o>=</span><span class=s2>&#34;properties.NOMGEO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color_discrete_sequence</span><span class=o>=</span><span class=n>px</span><span class=o>.</span><span class=n>colors</span><span class=o>.</span><span class=n>qualitative</span><span class=o>.</span><span class=n>T10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>projection</span><span class=o>=</span><span class=s2>&#34;mercator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Predominant Gender and Age Range in Voter Registration&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_geos</span><span class=p>(</span><span class=n>fitbounds</span><span class=o>=</span><span class=s2>&#34;locations&#34;</span><span class=p>,</span> <span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#-------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_gender_proportion_choropleth</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Aggregate data by MUNICIPIO if not already aggregated</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Calculate the percentage of women registered voters</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;Women Percentage&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;Lista Mujeres&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;Lista Nominal&#39;</span><span class=p>])</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ochre_scale</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>0.0</span><span class=p>,</span> <span class=s1>&#39;#4c78c8&#39;</span><span class=p>],</span>  <span class=c1># Blue</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>1.0</span><span class=p>,</span> <span class=s1>&#39;#f58518&#39;</span><span class=p>],</span>  <span class=c1># Light ochre (yellow)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Assuming `geojson` is your GeoJSON object for the municipalities</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>choropleth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_grouped</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>geojson</span><span class=o>=</span><span class=n>geojson_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>locations</span><span class=o>=</span><span class=s1>&#39;Nombre Municipio&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Women Percentage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>featureidkey</span><span class=o>=</span><span class=s2>&#34;properties.NOMGEO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color_continuous_scale</span><span class=o>=</span><span class=n>ochre_scale</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>projection</span><span class=o>=</span><span class=s2>&#34;mercator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s2>&#34;Percentage of Women in Voter Registration&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_geos</span><span class=p>(</span><span class=n>fitbounds</span><span class=o>=</span><span class=s2>&#34;locations&#34;</span><span class=p>,</span> <span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Update layout for colorbar position</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>coloraxis_colorbar</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=s1>&#39;Women Percentage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>orientation</span><span class=o>=</span><span class=s1>&#39;h&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>xanchor</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=-</span><span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>thickness</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>  <span class=c1># Adjust the thickness of the colorbar</span>
</span></span><span class=line><span class=cl>        <span class=nb>len</span><span class=o>=</span><span class=mf>0.65</span>       <span class=c1># Set the length as a fraction of the plot area width</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#-----------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_winning_party_per_year_choropleth</span><span class=p>(</span><span class=n>selected_year</span><span class=p>,</span> <span class=n>geojson</span><span class=p>,</span> <span class=n>main_parties</span><span class=p>,</span> <span class=n>df_dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># This function now handles a single year&#39;s DataFrame and generates a choropleth map for that year.</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>df_year</span> <span class=o>=</span> <span class=n>df_dict</span><span class=p>[</span><span class=n>selected_year</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>winning_party_by_municipality</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>municipality</span> <span class=ow>in</span> <span class=n>df_year</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>votes_by_party</span> <span class=o>=</span> <span class=p>{</span><span class=n>main_party</span><span class=p>:</span> <span class=mi>0</span> <span class=k>for</span> <span class=n>main_party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1># for main_party, parties in alliance_mapping.items():</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     for party in parties:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         if party in df_year.columns:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#             votes_by_party[main_party] += df_year.loc[df_year[&#39;MUNICIPIO&#39;] == municipality, party].sum()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>df_year</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>votes_by_party</span><span class=p>[</span><span class=n>party</span><span class=p>]</span> <span class=o>+=</span> <span class=n>df_year</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df_year</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>municipality</span><span class=p>,</span> <span class=n>party</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=n>winning_party</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>votes_by_party</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>votes_by_party</span><span class=o>.</span><span class=n>get</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>winning_party_by_municipality</span><span class=p>[</span><span class=n>municipality</span><span class=p>]</span> <span class=o>=</span> <span class=n>winning_party</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df_map</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>winning_party_by_municipality</span><span class=o>.</span><span class=n>items</span><span class=p>()),</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>,</span> <span class=s1>&#39;Winning Party&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>df_map</span><span class=p>[</span><span class=s1>&#39;Year&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>selected_year</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>choropleth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_map</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>geojson</span><span class=o>=</span><span class=n>geojson</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>locations</span><span class=o>=</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Winning Party&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>featureidkey</span><span class=o>=</span><span class=s2>&#34;properties.NOMGEO&#34;</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>        <span class=n>projection</span><span class=o>=</span><span class=s2>&#34;mercator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color_discrete_sequence</span><span class=o>=</span><span class=n>px</span><span class=o>.</span><span class=n>colors</span><span class=o>.</span><span class=n>qualitative</span><span class=o>.</span><span class=n>T10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_geos</span><span class=p>(</span><span class=n>fitbounds</span><span class=o>=</span><span class=s2>&#34;locations&#34;</span><span class=p>,</span> <span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;Winning Party per Municipality, </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#--------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot_election_pie_chart</span><span class=p>(</span><span class=n>selected_year</span><span class=p>,</span> <span class=n>selected_municipality</span><span class=p>,</span> <span class=n>df_re_all_years</span><span class=p>,</span> <span class=n>main_parties</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># mapping years to their indices in the list of dataframes</span>
</span></span><span class=line><span class=cl>    <span class=n>year_to_index</span> <span class=o>=</span> <span class=p>{</span><span class=mi>2009</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2012</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2015</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2018</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2021</span><span class=p>:</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>selected_year_index</span> <span class=o>=</span> <span class=n>year_to_index</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>selected_year</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>selected_year_index</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No data available for the year </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s2>.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># extract the dataframe for the selected year</span>
</span></span><span class=line><span class=cl>    <span class=n>df_selected_year</span> <span class=o>=</span> <span class=n>df_re_all_years</span><span class=p>[</span><span class=n>selected_year_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># filtering the df for the selected municipality</span>
</span></span><span class=line><span class=cl>    <span class=n>df_municipality</span> <span class=o>=</span> <span class=n>df_selected_year</span><span class=p>[</span><span class=n>df_selected_year</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>selected_municipality</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>df_municipality</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;No data available for </span><span class=si>{</span><span class=n>selected_municipality</span><span class=si>}</span><span class=s1>.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># aggregating votes for each main party</span>
</span></span><span class=line><span class=cl>    <span class=n>votes_by_party</span> <span class=o>=</span> <span class=p>{</span><span class=n>main_party</span><span class=p>:</span> <span class=mi>0</span> <span class=k>for</span> <span class=n>main_party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>df_municipality</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>votes_by_party</span><span class=p>[</span><span class=n>party</span><span class=p>]</span> <span class=o>+=</span> <span class=n>df_municipality</span><span class=p>[</span><span class=n>party</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># create the pie chart</span>
</span></span><span class=line><span class=cl>    <span class=n>df_votes</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>votes_by_party</span><span class=o>.</span><span class=n>items</span><span class=p>()),</span> <span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Party&#39;</span><span class=p>,</span> <span class=s1>&#39;Votes&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>pie</span><span class=p>(</span><span class=n>df_votes</span><span class=p>,</span> <span class=n>values</span> <span class=o>=</span> <span class=s1>&#39;Votes&#39;</span><span class=p>,</span> <span class=n>names</span> <span class=o>=</span> <span class=s1>&#39;Party&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=n>title</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;Vote Distribution in </span><span class=si>{</span><span class=n>selected_municipality</span><span class=si>}</span><span class=s1>, </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=n>color_discrete_sequence</span><span class=o>=</span><span class=n>px</span><span class=o>.</span><span class=n>colors</span><span class=o>.</span><span class=n>qualitative</span><span class=o>.</span><span class=n>T10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Update the traces to remove the text labels</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_traces</span><span class=p>(</span><span class=n>textinfo</span><span class=o>=</span><span class=s1>&#39;none&#39;</span><span class=p>,</span> <span class=n>hoverinfo</span><span class=o>=</span><span class=s1>&#39;label+percent&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot_aggregated_votes_by_main_party_px</span><span class=p>(</span><span class=n>df_list</span><span class=p>,</span> <span class=n>main_parties</span><span class=p>,</span> <span class=n>selected_municipality</span><span class=p>,</span> <span class=n>election_years</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Plots an interactive line plot with filled areas to zero for each main party and its alliances,
</span></span></span><span class=line><span class=cl><span class=s2>    in a selected municipality across elections using Plotly Express. This approximates the non-stacked
</span></span></span><span class=line><span class=cl><span class=s2>    area plot behavior of the original function.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># initialize dictionary to hold vote totals for main parties</span>
</span></span><span class=line><span class=cl>    <span class=n>votes_by_main_party</span> <span class=o>=</span> <span class=p>{</span><span class=n>main_party</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>election_years</span><span class=p>)</span> <span class=k>for</span> <span class=n>main_party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># loop through each DataFrame and year</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>year</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>df_list</span><span class=p>,</span> <span class=n>election_years</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=c1># filter the DataFrame for the selected municipality</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>selected_municipality</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>filtered_df</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=n>selected_municipality</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># loop through each main party and its alliances</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>main_parties</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># aggregate votes for each party in the alliance, adding to the main party&#39;s total</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>party</span> <span class=ow>in</span> <span class=n>filtered_df</span><span class=o>.</span><span class=n>columns</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>votes_by_main_party</span><span class=p>[</span><span class=n>party</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>+=</span> <span class=n>filtered_df</span><span class=p>[</span><span class=n>party</span><span class=p>]</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># prepare the data for plotting</span>
</span></span><span class=line><span class=cl>    <span class=n>data_for_plotting</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>main_party</span><span class=p>,</span> <span class=n>votes</span> <span class=ow>in</span> <span class=n>votes_by_main_party</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>year</span><span class=p>,</span> <span class=n>vote</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>election_years</span><span class=p>,</span> <span class=n>votes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>data_for_plotting</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s1>&#39;Election Year&#39;</span><span class=p>:</span> <span class=n>year</span><span class=p>,</span> <span class=s1>&#39;Total Votes&#39;</span><span class=p>:</span> <span class=n>vote</span><span class=p>,</span> <span class=s1>&#39;Party&#39;</span><span class=p>:</span> <span class=n>main_party</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=n>df_plot</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>data_for_plotting</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># create the plot</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>line</span><span class=p>(</span><span class=n>df_plot</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Election Year&#39;</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Total Votes&#39;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Party&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>line_shape</span><span class=o>=</span><span class=s1>&#39;linear&#39;</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;Total Votes per Party (Including Alliances), in </span><span class=si>{</span><span class=n>selected_municipality</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=n>color_discrete_sequence</span><span class=o>=</span><span class=n>px</span><span class=o>.</span><span class=n>colors</span><span class=o>.</span><span class=n>qualitative</span><span class=o>.</span><span class=n>T10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># customize the layout</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_traces</span><span class=p>(</span><span class=n>mode</span><span class=o>=</span><span class=s1>&#39;lines&#39;</span><span class=p>,</span> <span class=n>line</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>width</span><span class=o>=</span><span class=mf>2.5</span><span class=p>),</span> <span class=n>fill</span><span class=o>=</span><span class=s1>&#39;tozeroy&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span><span class=n>xaxis_title</span><span class=o>=</span><span class=s1>&#39;Election Year&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>yaxis_title</span><span class=o>=</span><span class=s1>&#39;Total Votes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>legend_title</span><span class=o>=</span><span class=s1>&#39;Party&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>font</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>family</span><span class=o>=</span><span class=s2>&#34;Arial, sans-serif&#34;</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>12</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&#34;#333&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                      <span class=n>hovermode</span><span class=o>=</span><span class=s1>&#39;x unified&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=n>legend</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                          <span class=n>orientation</span> <span class=o>=</span> <span class=s1>&#39;h&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>yanchor</span> <span class=o>=</span> <span class=s1>&#39;bottom&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>y</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.6</span><span class=p>,</span> <span class=c1># adjuist to fit layout</span>
</span></span><span class=line><span class=cl>                          <span class=n>xanchor</span> <span class=o>=</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>x</span> <span class=o>=</span> <span class=mf>0.5</span>
</span></span><span class=line><span class=cl>                      <span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#----------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># HELPER function to get the municipalities per selected year</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_municipalities_per_year</span><span class=p>(</span><span class=n>df_dict</span><span class=p>,</span> <span class=n>selected_year</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>df_selected</span> <span class=o>=</span> <span class=n>df_dict</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>selected_year</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>df_selected</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No data available for the year </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s2>.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Retrieve and return a sorted list of unique municipalities</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>df_selected</span><span class=p>[</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>unique</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#-------------------------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_voter_turnout_proportion_choropleth</span><span class=p>(</span><span class=n>df_resultados</span><span class=p>,</span> <span class=n>selected_year</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Aggregate data by MUNICIPIO if not already aggregated</span>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span> <span class=o>=</span> <span class=n>df_resultados</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>agg</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;TOTAL_VOTOS&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;LISTA_NOMINAL&#39;</span><span class=p>:</span> <span class=s1>&#39;sum&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;Porcentaje Votantes&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;TOTAL_VOTOS&#39;</span><span class=p>]</span> <span class=o>/</span> <span class=n>df_grouped</span><span class=p>[</span><span class=s1>&#39;LISTA_NOMINAL&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ochre_scale</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>0.0</span><span class=p>,</span> <span class=s1>&#39;#4c78c8&#39;</span><span class=p>],</span>  <span class=c1># Blue</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=mf>1.0</span><span class=p>,</span> <span class=s1>&#39;#f58518&#39;</span><span class=p>],</span>  <span class=c1># Light ochre (yellow)</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Assuming `geojson` is your GeoJSON object for the municipalities</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span> <span class=o>=</span> <span class=n>px</span><span class=o>.</span><span class=n>choropleth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_grouped</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>geojson</span><span class=o>=</span><span class=n>geojson_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>locations</span><span class=o>=</span><span class=s1>&#39;MUNICIPIO&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;Porcentaje Votantes&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>featureidkey</span><span class=o>=</span><span class=s2>&#34;properties.NOMGEO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color_continuous_scale</span><span class=o>=</span><span class=n>ochre_scale</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>projection</span><span class=o>=</span><span class=s2>&#34;mercator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;Voter Turnout Percentage in </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_geos</span><span class=p>(</span><span class=n>fitbounds</span><span class=o>=</span><span class=s2>&#34;locations&#34;</span><span class=p>,</span> <span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Update layout for colorbar position</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>coloraxis_colorbar</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>title</span><span class=o>=</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Voter Turnout Percentage in </span><span class=si>{</span><span class=n>selected_year</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>orientation</span><span class=o>=</span><span class=s1>&#39;h&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>xanchor</span><span class=o>=</span><span class=s1>&#39;center&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=-</span><span class=mf>0.2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>thickness</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>  <span class=c1># Adjust the thickness of the colorbar</span>
</span></span><span class=line><span class=cl>        <span class=nb>len</span><span class=o>=</span><span class=mf>0.65</span>       <span class=c1># Set the length as a fraction of the plot area width</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>fig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># static figures:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>static_choropleth_percentage_women</span> <span class=o>=</span> <span class=n>create_gender_proportion_choropleth</span><span class=p>(</span><span class=n>df_ln_sx_qroo</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>static_choropleth_age</span> <span class=o>=</span> <span class=n>create_age_choropleth</span><span class=p>(</span><span class=n>df_ln_age_qroo</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>static_choropleth_totals</span> <span class=o>=</span> <span class=n>create_total_choropleth</span><span class=p>(</span><span class=n>df_ln_sx_qroo</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>static_bar_totals</span> <span class=o>=</span> <span class=n>create_total_bar_plot</span><span class=p>(</span><span class=n>df_ln_sx_qroo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create a Dash application</span>
</span></span><span class=line><span class=cl><span class=c1># app = Dash(__name__)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Assuming you&#39;re fine with adding Bootstrap to your project</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Dash</span><span class=p>(</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>external_stylesheets</span><span class=o>=</span><span class=p>[</span><span class=n>dbc</span><span class=o>.</span><span class=n>themes</span><span class=o>.</span><span class=n>BOOTSTRAP</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>css</span><span class=o>.</span><span class=n>append_css</span><span class=p>({</span><span class=s1>&#39;external_url&#39;</span><span class=p>:</span> <span class=s1>&#39;/assets/styles.css&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>colors</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;background&#39;</span><span class=p>:</span> <span class=s1>&#39;#111111&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;text&#39;</span><span class=p>:</span> <span class=s1>&#39;#7FDBFF&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>server</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Layout</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>layout</span> <span class=o>=</span> <span class=n>dbc</span><span class=o>.</span><span class=n>Container</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>html</span><span class=o>.</span><span class=n>H1</span><span class=p>(</span><span class=s2>&#34;Elections Dashboard&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>dbc</span><span class=o>.</span><span class=n>Row</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Dropdown</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=s1>&#39;year-dropdown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>options</span><span class=o>=</span><span class=p>[{</span><span class=s1>&#39;label&#39;</span><span class=p>:</span> <span class=n>year</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>year</span><span class=p>}</span> <span class=k>for</span> <span class=n>year</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>election_years</span><span class=p>))],</span>
</span></span><span class=line><span class=cl>            <span class=n>value</span><span class=o>=</span><span class=nb>sorted</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>election_years</span><span class=p>))[</span><span class=mi>0</span><span class=p>],</span>  <span class=c1># Default to the earliest year</span>
</span></span><span class=line><span class=cl>            <span class=n>className</span><span class=o>=</span><span class=s1>&#39;dropdown&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span> <span class=n>className</span> <span class=o>=</span> <span class=s1>&#39;mb-2&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Dropdown</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=s1>&#39;municipio-dropdown&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>className</span><span class=o>=</span><span class=s1>&#39;dropdown&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span> <span class=n>className</span> <span class=o>=</span> <span class=s1>&#39;mb-2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=n>dbc</span><span class=o>.</span><span class=n>Row</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;time-series-plot&#39;</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;pie-chart&#39;</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=n>dbc</span><span class=o>.</span><span class=n>Row</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;choropleth-total-voters&#39;</span><span class=p>,</span> <span class=n>figure</span> <span class=o>=</span> <span class=n>static_choropleth_totals</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;choropleth-turnout&#39;</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=n>dbc</span><span class=o>.</span><span class=n>Row</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;choropleth-age&#39;</span><span class=p>,</span> <span class=n>figure</span><span class=o>=</span><span class=n>static_choropleth_age</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;choropleth-women&#39;</span><span class=p>,</span> <span class=n>figure</span><span class=o>=</span><span class=n>static_choropleth_percentage_women</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>]),</span>
</span></span><span class=line><span class=cl>    <span class=n>dbc</span><span class=o>.</span><span class=n>Row</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;choropleth-winning&#39;</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>dbc</span><span class=o>.</span><span class=n>Col</span><span class=p>(</span><span class=n>dcc</span><span class=o>.</span><span class=n>Graph</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;bar-total-voters&#39;</span><span class=p>,</span> <span class=n>figure</span><span class=o>=</span><span class=n>static_bar_totals</span><span class=p>,</span> <span class=n>className</span><span class=o>=</span><span class=s1>&#39;graph-container&#39;</span><span class=p>),</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span> <span class=n>lg</span> <span class=o>=</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>],</span> <span class=n>fluid</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Callback to update municipio dropdown based on year selection</span>
</span></span><span class=line><span class=cl><span class=nd>@app.callback</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;municipio-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;options&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;municipio-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>Input</span><span class=p>(</span><span class=s1>&#39;year-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>set_municipio_options</span><span class=p>(</span><span class=n>selected_year</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Assuming a function that returns municipios for a given year</span>
</span></span><span class=line><span class=cl>    <span class=n>municipalities</span> <span class=o>=</span> <span class=n>get_municipalities_per_year</span><span class=p>(</span><span class=n>df_dict</span><span class=p>,</span> <span class=n>selected_year</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>options</span> <span class=o>=</span> <span class=p>[{</span><span class=s1>&#39;label&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>m</span><span class=p>}</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>municipalities</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>new_value</span> <span class=o>=</span> <span class=n>municipalities</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=n>municipalities</span> <span class=k>else</span> <span class=kc>None</span>  <span class=c1># Default to first municipality or None</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>options</span><span class=p>,</span> <span class=n>new_value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Callback to update interactive visualizations</span>
</span></span><span class=line><span class=cl><span class=nd>@app.callback</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>Output</span><span class=p>(</span><span class=s1>&#39;time-series-plot&#39;</span><span class=p>,</span> <span class=s1>&#39;figure&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;pie-chart&#39;</span><span class=p>,</span> <span class=s1>&#39;figure&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;choropleth-winning&#39;</span><span class=p>,</span> <span class=s1>&#39;figure&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;choropleth-turnout&#39;</span><span class=p>,</span> <span class=s1>&#39;figure&#39;</span><span class=p>)],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>Input</span><span class=p>(</span><span class=s1>&#39;year-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>     <span class=n>Input</span><span class=p>(</span><span class=s1>&#39;municipio-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update_visualizations</span><span class=p>(</span><span class=n>selected_year</span><span class=p>,</span> <span class=n>selected_municipality</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>time_series_chart</span> <span class=o>=</span> <span class=n>plot_aggregated_votes_by_main_party_px</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>df_re_all_years</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>main_parties</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>selected_municipality</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>election_years</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>pie_chart_per_municipality_per_year</span> <span class=o>=</span> <span class=n>plot_election_pie_chart</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>selected_year</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>selected_municipality</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>df_re_all_years</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>main_parties</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>choropleth_winning_party_per_year</span> <span class=o>=</span> <span class=n>create_winning_party_per_year_choropleth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>selected_year</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>geojson_data</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>main_parties</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>df_dict</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>df_resultados</span> <span class=o>=</span> <span class=n>df_dict</span><span class=p>[</span><span class=n>selected_year</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>voter_proportion_choropleth</span> <span class=o>=</span> <span class=n>create_voter_turnout_proportion_choropleth</span><span class=p>(</span><span class=n>df_resultados</span><span class=p>,</span> <span class=n>selected_year</span><span class=p>,</span> <span class=n>geojson_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>time_series_chart</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>pie_chart_per_municipality_per_year</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>            <span class=n>choropleth_winning_party_per_year</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>voter_proportion_choropleth</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run_server</span><span class=p>()</span>
</span></span></code></pre></div></div><footer class=post-footer><nav class=paginav><a class=prev href=http://localhost:1313/posts/20240509_election_dash_part_1-data_cleaning/election_dash_part_1-data_cleaning/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Election Data Dashboard Pt. 1: Collection and Cleaning</span>
</a><a class=next href=http://localhost:1313/posts/20240222_bayesian_time_series_analysis/20240222_bayesian_time_series_analysis/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Bayesian Time Series Analysis with Julia and Turing.jl</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>Victor Flores</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>