<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Transfer Learning Classifier Again... with Julia! | Victor Flores, PhD</title>
<meta name=keywords content="Classification,Deep Learning,Machine Learning,Julia,Flux.jl,Transfer Learning"><meta name=description content="Replicating the cat mood classifier, this time using Julia and Flux.jl."><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/20240521_julia_transfer_learning_v5/20240521_julia_transfer_learning_v5/><link crossorigin=anonymous href=/assets/css/stylesheet.min.cc305c161bc6ee4c6ba7ee115b6e10dd6be37f10696b436f93d754dee01c7e81.css integrity="sha256-zDBcFhvG7kxrp+4RW24Q3WvjfxBpa0Nvk9dU3uAcfoE=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=alternate hreflang=en href=http://localhost:1313/posts/20240521_julia_transfer_learning_v5/20240521_julia_transfer_learning_v5/><meta name=twitter:title content="Transfer Learning Classifier Again... with Julia! | Victor Flores, PhD"><meta name=twitter:description content="Replicating the cat mood classifier, this time using Julia and Flux.jl."><meta property="og:title" content="Transfer Learning Classifier Again... with Julia! | Victor Flores, PhD"><meta property="og:description" content="Replicating the cat mood classifier, this time using Julia and Flux.jl."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/20240521_julia_transfer_learning_v5/20240521_julia_transfer_learning_v5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-21T22:38:29+08:00"><meta property="article:modified_time" content="2024-05-21T22:38:29+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Transfer Learning Classifier Again... with Julia!","item":"http://localhost:1313/posts/20240521_julia_transfer_learning_v5/20240521_julia_transfer_learning_v5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Transfer Learning Classifier Again... with Julia! | Victor Flores, PhD","name":"Transfer Learning Classifier Again... with Julia!","description":"Replicating the cat mood classifier, this time using Julia and Flux.jl.","keywords":["Classification","Deep Learning","Machine Learning","Julia","Flux.jl","Transfer Learning"],"wordCount":"2934","inLanguage":"en","datePublished":"2024-05-21T22:38:29+08:00","dateModified":"2024-05-21T22:38:29+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/20240521_julia_transfer_learning_v5/20240521_julia_transfer_learning_v5/"},"publisher":{"@type":"Organization","name":"Victor Flores, PhD","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type=text/x-mathjax-config>
        MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true
        }
        });
    </script></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Victor Flores, PhD (Alt + H)">Victor Flores, PhD</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=Tags>Tags</a></li><li><a href=http://localhost:1313/archives/ title=Archive>Archive</a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" data-no-instant accesskey=/>Search</a></li><li><a href=http://localhost:1313/about/ title=About>About</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Transfer Learning Classifier Again... with Julia!</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>May 21, 2024</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=http://localhost:1313/tags/classification/>Classification</a><a href=http://localhost:1313/tags/deep-learning/>Deep Learning</a><a href=http://localhost:1313/tags/machine-learning/>Machine Learning</a><a href=http://localhost:1313/tags/julia/>Julia</a><a href=http://localhost:1313/tags/flux.jl/>Flux.jl</a><a href=http://localhost:1313/tags/transfer-learning/>Transfer Learning</a></span></span></div></header><div class=post-content><hr><p><img loading=lazy src=/images/20240521_julia_transfer_learning_v5/intro.png type alt=image></p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>¶</a></h2><p>This guide demonstrates how to apply transfer learning using a pre-trained vision model to classify cat moods based on their facila expressions. We&rsquo;ll learn how to handle custom data setups.</p><p>In this demonstration, we recreate the exercise done in PyTorch, <a href=https://vflores-io.github.io/posts/20240515_cat_mood_classification/>available here</a>. Since that demonstration is quite detailed, we keep it pretty straightforward here.</p><h4 id=motivation--credit>Motivation & Credit<a hidden class=anchor aria-hidden=true href=#motivation--credit>¶</a></h4><p>When I thought about learning how to implement a computer vision classification model for transfer learning in Julia and <code>Flux</code>, I immediately came upon two roadblocks:</p><ol><li>Since I am not an expert in Julia, I found the documentation to be a bit difficult to access (again, this is just me!).</li><li>There are not many tutorials or resources to illustrate this particular case.</li></ol><p>Therefore I took it upon myself to put things together and make a demonstration that would hopefully be useful for someone who might not be an expert in Flux (or Julia).</p><p>This particular demo was inspired by a combination of the following resources:</p><ul><li><a href=https://towardsdatascience.com/transfer-learning-and-twin-network-for-image-classification-using-flux-jl-cbe012ced146>Transfer Learning and Twin Network for Image Classification using <code>Flux.jl</code></a></li><li><a href=https://github.com/FluxML/model-zoo/tree/master/tutorials/transfer_learning><code>Flux.jl</code>&rsquo;s Model Zoo Tutorial</a></li><li><a href=https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html><code>PyTorch</code> Transfer Learning for Computer Vision Tutorial</a></li></ul><h2 id=getting-started>Getting Started<a hidden class=anchor aria-hidden=true href=#getting-started>¶</a></h2><p>We will use a pre-trained <code>ResNet18</code> model, initially trained on a general dataset, and fine-tune it for our specific task of classifying cat moods.</p><h3 id=initialization>Initialization<a hidden class=anchor aria-hidden=true href=#initialization>¶</a></h3><p>First, we activate the current directory as our project environment by calling the package manager <code>Pkg</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>using</span> <span class=n>Pkg</span>
</span></span><span class=line><span class=cl><span class=n>Pkg</span><span class=o>.</span><span class=n>activate</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>)</span> 
</span></span></code></pre></div><p>Then we will import the required packages. Of course, this is also assuming that one has already added the relevant packages into the environment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>using</span> <span class=n>Pkg</span>
</span></span><span class=line><span class=cl><span class=n>Pkg</span><span class=o>.</span><span class=n>activate</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Random</span><span class=o>:</span> <span class=n>shuffle!</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=n>Base</span><span class=o>:</span> <span class=n>length</span><span class=p>,</span> <span class=n>getindex</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Images</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Flux</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Flux</span><span class=o>:</span> <span class=n>update!</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>DataAugmentation</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Metalhead</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>MLUtils</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>DataFrames</span><span class=p>,</span> <span class=n>CSV</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Plots</span>
</span></span></code></pre></div><pre><code>[32m[1m  Activating[22m[39m project at `H:\My Drive\Projects\Coding\Portfolio\Machine Learning\Julia\Transfer Learning with Flux`
</code></pre><h3 id=retrieve-the-data-and-initial-setup>Retrieve the Data and Initial Setup<a hidden class=anchor aria-hidden=true href=#retrieve-the-data-and-initial-setup>¶</a></h3><p>First, we specify the paths to the dataset and labels CSV files for training, validation, and test sets. Then, we load these CSV files into <code>DataFrames</code>. Finally, we create vectors of absolute file paths for each image in the dataset.</p><p>This setup is essential for organizing the data and ensuring that our model can access the correct images and labels during training and evaluation.</p><h4 id=label-structure>Label Structure<a hidden class=anchor aria-hidden=true href=#label-structure>¶</a></h4><p>The data set we are using consists of three folders: <code>train</code>, <code>val</code>, <code>test</code>. Each of them contain a set of images of cats. The labels in this case, are in the form of a CSV file that maps the filename with a one-hot encoding to label the classification of the image, i.e. the cat&rsquo;s mood - alarmed, angry, calm, pleased.</p><p>The dataset was obtained <a href=https://universe.roboflow.com/mubbarryz/domestic-cats-facial-expressions>here</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># specify the paths to the dataset and labels CSV</span>
</span></span><span class=line><span class=cl><span class=n>train_data_path</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/train&#34;</span>
</span></span><span class=line><span class=cl><span class=n>train_data_csv</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/train/_classes.csv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>val_data_path</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/val&#34;</span>
</span></span><span class=line><span class=cl><span class=n>val_data_csv</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/val/_classes.csv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>test_data_path</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/test&#34;</span>
</span></span><span class=line><span class=cl><span class=n>test_data_csv</span> <span class=o>=</span> <span class=s>&#34;data/cat_expression_data/test/_classes.csv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># load the CSV file containing the labels</span>
</span></span><span class=line><span class=cl><span class=n>train_labels_df</span> <span class=o>=</span> <span class=n>CSV</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>train_data_csv</span><span class=p>,</span> <span class=n>DataFrame</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>test_labels_df</span> <span class=o>=</span> <span class=n>CSV</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>test_data_csv</span><span class=p>,</span> <span class=n>DataFrame</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>val_labels_df</span> <span class=o>=</span> <span class=n>CSV</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>val_data_csv</span><span class=p>,</span> <span class=n>DataFrame</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># setup filepaths to the files as vectors</span>
</span></span><span class=line><span class=cl><span class=n>train_filepaths</span> <span class=o>=</span> <span class=p>[</span><span class=n>abspath</span><span class=p>(</span><span class=n>joinpath</span><span class=p>(</span><span class=n>train_data_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>))</span> <span class=k>for</span> <span class=n>filename</span> <span class=k>in</span> <span class=n>train_labels_df</span><span class=p>[</span><span class=o>!</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>test_filepaths</span> <span class=o>=</span> <span class=p>[</span><span class=n>abspath</span><span class=p>(</span><span class=n>joinpath</span><span class=p>(</span><span class=n>test_data_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>))</span> <span class=k>for</span> <span class=n>filename</span> <span class=k>in</span> <span class=n>test_labels_df</span><span class=p>[</span><span class=o>!</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>val_filepaths</span> <span class=o>=</span> <span class=p>[</span><span class=n>abspath</span><span class=p>(</span><span class=n>joinpath</span><span class=p>(</span><span class=n>val_data_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>))</span> <span class=k>for</span> <span class=n>filename</span> <span class=k>in</span> <span class=n>val_labels_df</span><span class=p>[</span><span class=o>!</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=p>]</span>
</span></span></code></pre></div><pre><code>110-element Vector{String}:
 
 ⋮
</code></pre><h3 id=data-exploration>Data Exploration<a hidden class=anchor aria-hidden=true href=#data-exploration>¶</a></h3><p>As usual, we take a look at the data to understand what we are working with.</p><p>Below we make a couple of functions to visualize the data.</p><p>Note that the helper function <code>label_from_row</code> will come in handy later on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># -----------------------------------------------------------------------#</span>
</span></span><span class=line><span class=cl><span class=c># helper function to extract label from the DataFrame</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=n>label_from_row</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>labels_df</span><span class=p>,</span> <span class=n>label_dict</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c># retrieve the label for the image from the DataFrame</span>
</span></span><span class=line><span class=cl>    <span class=n>label_row</span> <span class=o>=</span> <span class=n>filter</span><span class=p>(</span><span class=n>row</span> <span class=o>-&gt;</span> <span class=n>row</span><span class=o>.</span><span class=n>filename</span> <span class=o>==</span> <span class=n>filename</span><span class=p>,</span> <span class=n>labels_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>label_index</span> <span class=o>=</span> <span class=n>findfirst</span><span class=p>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>label_row</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=n>x</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>,</span> <span class=n>names</span><span class=p>(</span><span class=n>labels_df</span><span class=p>)[</span><span class=mi>2</span><span class=o>:</span><span class=k>end</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>label_dict</span><span class=p>[</span><span class=n>label_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=c># -----------------------------------------------------------------------#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># function to display a selection of images and their labels</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=n>show_sample_images_and_labels</span><span class=p>(</span><span class=n>labels_df</span><span class=p>,</span> <span class=n>label_dict</span><span class=p>;</span> <span class=n>num_samples</span> <span class=o>=</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c># randomly pick indices for sampling images</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_indices</span> <span class=o>=</span> <span class=n>rand</span><span class=p>(</span><span class=mi>1</span><span class=o>:</span><span class=n>nrow</span><span class=p>(</span><span class=n>labels_df</span><span class=p>),</span> <span class=n>num_samples</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_filenames</span> <span class=o>=</span> <span class=n>labels_df</span><span class=o>.</span><span class=n>filename</span><span class=p>[</span><span class=n>sample_indices</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c># calculate number of rows and columns for the grid layuot</span>
</span></span><span class=line><span class=cl>    <span class=n>num_cols</span> <span class=o>=</span> <span class=n>ceil</span><span class=p>(</span><span class=kt>Int</span><span class=p>,</span> <span class=n>num_samples</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num_rows</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c># prepare a plot with a grid layout for the images</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>plot</span><span class=p>(</span><span class=n>layout</span> <span class=o>=</span> <span class=p>(</span><span class=n>num_rows</span><span class=p>,</span> <span class=n>num_cols</span><span class=p>),</span> <span class=n>size</span><span class=p>(</span><span class=mi>800</span><span class=p>,</span> <span class=mi>200</span><span class=p>),</span> <span class=n>legend</span> <span class=o>=</span> <span class=nb>false</span><span class=p>,</span> <span class=n>axis</span> <span class=o>=</span> <span class=nb>false</span><span class=p>,</span> <span class=n>grid</span> <span class=o>=</span> <span class=nb>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c># load and plot each sampled image</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span> <span class=k>in</span> <span class=n>enumerate</span><span class=p>(</span><span class=n>sample_filenames</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img_path</span> <span class=o>=</span> <span class=n>joinpath</span><span class=p>(</span><span class=n>train_data_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>load</span><span class=p>(</span><span class=n>img_path</span><span class=p>)</span>   <span class=c># load the image from the file</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># retrieve the label for the image from the DataFrame</span>
</span></span><span class=line><span class=cl>        <span class=n>label</span> <span class=o>=</span> <span class=n>label_from_row</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>labels_df</span><span class=p>,</span> <span class=n>label_dict</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>plot!</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=n>index</span><span class=p>],</span> <span class=n>img</span><span class=p>,</span> <span class=n>title</span> <span class=o>=</span> <span class=n>label</span><span class=p>,</span> <span class=n>axis</span> <span class=o>=</span> <span class=nb>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>display</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>   <span class=c># display the plot</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># define a dictionary for label descriptions:</span>
</span></span><span class=line><span class=cl><span class=n>label_dict</span> <span class=o>=</span> <span class=kt>Dict</span><span class=p>(</span><span class=mi>1</span> <span class=o>=&gt;</span> <span class=s>&#34;alarmed&#34;</span><span class=p>,</span> <span class=mi>2</span> <span class=o>=&gt;</span> <span class=s>&#34;angry&#34;</span><span class=p>,</span> <span class=mi>3</span> <span class=o>=&gt;</span> <span class=s>&#34;calm&#34;</span><span class=p>,</span> <span class=mi>4</span> <span class=o>=&gt;</span> <span class=s>&#34;pleased&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># run the function to show images</span>
</span></span><span class=line><span class=cl><span class=n>show_sample_images_and_labels</span><span class=p>(</span><span class=n>train_labels_df</span><span class=p>,</span> <span class=n>label_dict</span><span class=p>)</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/20240521_julia_transfer_learning_v5/output_6_0.svg type alt=svg></p><h3 id=working-with-custom-datasets>Working with Custom Datasets<a hidden class=anchor aria-hidden=true href=#working-with-custom-datasets>¶</a></h3><p>When working with custom datasets in Julia, the concepts are similar as in PyTorch, but obviously following Julia&rsquo;s syntax.</p><p>In essence, we read the CSV files containing image file paths and their corresponding labels into DataFrames. We then create functions to handle data loading and transformations, such as resizing and normalizing images. This approach is similar to PyTorch&rsquo;s <code>Dataset</code>.</p><p>Let&rsquo;s have a quick look.</p><h3 id=create-a-custom-dataset>Create a Custom Dataset<a hidden class=anchor aria-hidden=true href=#create-a-custom-dataset>¶</a></h3><p>We define a custom dataset using a <code>struct</code>, which is similar to using a <code>class</code> in Python. The <code>ImageContainer</code> struct stores the image file paths and their corresponding labels in a DataFrame. We then create instances of this <code>struct</code> for the training, validation, and test datasets.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>struct</span> <span class=kt>ImageContainer</span><span class=p>{</span><span class=kt>T</span><span class=o>&lt;:</span><span class=kt>Vector</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>img</span><span class=o>::</span><span class=kt>T</span>
</span></span><span class=line><span class=cl>    <span class=n>labels_df</span><span class=o>::</span><span class=kt>DataFrame</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># generate dataset</span>
</span></span><span class=line><span class=cl><span class=n>train_dataset</span> <span class=o>=</span> <span class=n>ImageContainer</span><span class=p>(</span><span class=n>train_filepaths</span><span class=p>,</span> <span class=n>train_labels_df</span><span class=p>);</span>   
</span></span><span class=line><span class=cl><span class=n>val_dataset</span> <span class=o>=</span> <span class=n>ImageContainer</span><span class=p>(</span><span class=n>val_filepaths</span><span class=p>,</span> <span class=n>val_labels_df</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>test_dataset</span> <span class=o>=</span> <span class=n>ImageContainer</span><span class=p>(</span><span class=n>test_filepaths</span><span class=p>,</span> <span class=n>test_labels_df</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=create-the-data-loaders>Create the Data Loaders<a hidden class=anchor aria-hidden=true href=#create-the-data-loaders>¶</a></h4><p>In this section, we set up data loaders for our custom dataset in Julia, similar to how data loaders are used in PyTorch to manage batching and shuffling of data.</p><ol><li><p>Call helper Function: <code>label_from_row()</code> : This function extracts the label from the DataFrame for a given image file. It finds the index of the column with a value of 1, indicating the class.</p></li><li><p>Length and Indexing:</p></li></ol><ul><li><code>length(data::ImageContainer)</code>: Defines the length method to return the number of images in the dataset. Similar to PyTorch&rsquo;s <code>__len__</code>.</li><li><code>getindex(data::ImageContainer, idx::Int)</code>: This method is similar to PyTorch’s <code>__getitem__</code>. It loads an image, applies transformations, and returns the processed image along with its label.</li></ul><ol start=3><li>Data Augmentation and Transformations:</li></ol><ul><li>pipeline: Defines a transformation pipeline for scaling and cropping images.</li><li>transforms(image, labels_df): Inside getindex, this function applies the transformations to the image and normalizes it using the predefined mean and standard deviation values.</li></ul><ol start=4><li>DataLoaders:</li></ol><ul><li><code>train_loader</code> and <code>val_loader</code>: These DataLoader objects manage batching, shuffling, and parallel processing of the training and validation datasets, similar to <code>torch.utils.data.DataLoader</code> in PyTorch</li></ul><h5 id=notes-on-implementing-custom-data-containers>Notes on Implementing Custom Data Containers<a hidden class=anchor aria-hidden=true href=#notes-on-implementing-custom-data-containers>¶</a></h5><p>According to the documentation for MLUtils.DataLoader (<a href=https://fluxml.ai/Flux.jl/stable/data/mlutils/>see here</a>), custom data containers should implement Base.length instead of <code>numobs</code>, and Base.getindex instead of <code>getobs</code>, unless there&rsquo;s a difference between these functions and the base methods for multi-dimensional arrays.</p><p>Base.length: Should be implemented to return the number of observations. This is akin to PyTorch&rsquo;s <code>__len__</code>.
Base.getindex: Should be implemented to handle indexing of the dataset, similar to PyTorch&rsquo;s <code>__getitem__</code>.
These methods ensure that the data is returned in a form suitable for the learning algorithm, maintaining consistency whether the index is a scalar or vector.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>length</span><span class=p>(</span><span class=n>data</span><span class=o>::</span><span class=kt>ImageContainer</span><span class=p>)</span> <span class=o>=</span> <span class=n>length</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>im_size</span> <span class=o>=</span> <span class=p>(</span><span class=mi>224</span><span class=p>,</span> <span class=mi>224</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>DATA_MEAN</span> <span class=o>=</span> <span class=p>[</span><span class=mf>0.485f0</span><span class=p>,</span> <span class=mf>0.456f0</span><span class=p>,</span> <span class=mf>0.406f0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>DATA_STD</span> <span class=o>=</span> <span class=p>[</span><span class=mf>0.229f0</span><span class=p>,</span> <span class=mf>0.224f0</span><span class=p>,</span> <span class=mf>0.225f0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># define a transformation pipeline</span>
</span></span><span class=line><span class=cl><span class=n>pipeline</span> <span class=o>=</span> <span class=n>DataAugmentation</span><span class=o>.</span><span class=n>compose</span><span class=p>(</span><span class=n>ScaleKeepAspect</span><span class=p>(</span><span class=n>im_size</span><span class=p>),</span> <span class=n>CenterCrop</span><span class=p>(</span><span class=n>im_size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=n>getindex</span><span class=p>(</span><span class=n>data</span><span class=o>::</span><span class=kt>ImageContainer</span><span class=p>,</span> <span class=n>idx</span><span class=o>::</span><span class=kt>Int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>image</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>img</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>labels_df</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>labels_df</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=n>transforms</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>labels_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pipeline</span> <span class=o>=</span> <span class=n>ScaleKeepAspect</span><span class=p>(</span><span class=n>im_size</span><span class=p>)</span> <span class=o>|&gt;</span> <span class=n>CenterCrop</span><span class=p>(</span><span class=n>im_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>_img</span> <span class=o>=</span> <span class=n>Images</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>_img</span> <span class=o>=</span> <span class=n>apply</span><span class=p>(</span><span class=n>pipeline</span><span class=p>,</span> <span class=n>Image</span><span class=p>(</span><span class=n>_img</span><span class=p>))</span> <span class=o>|&gt;</span> <span class=n>itemdata</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>collect</span><span class=p>(</span><span class=n>channelview</span><span class=p>(</span><span class=n>float32</span><span class=o>.</span><span class=p>(</span><span class=n>RGB</span><span class=o>.</span><span class=p>(</span><span class=n>_img</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>        <span class=n>img</span> <span class=o>=</span> <span class=n>permutedims</span><span class=p>((</span><span class=n>img</span> <span class=o>.-</span> <span class=n>DATA_MEAN</span><span class=p>)</span> <span class=o>./</span> <span class=n>DATA_STD</span><span class=p>,</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>label</span> <span class=o>=</span> <span class=n>label_from_row</span><span class=p>(</span><span class=n>labels_df</span><span class=p>[</span><span class=n>idx</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=p>,</span> <span class=n>labels_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>img</span><span class=p>,</span> <span class=n>label</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>transforms</span><span class=p>(</span><span class=n>image</span><span class=p>,</span> <span class=n>labels_df</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>train_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>train_dataset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>batchsize</span> <span class=o>=</span> <span class=mi>16</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>collate</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>parallel</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>val_loader</span> <span class=o>=</span> <span class=n>DataLoader</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>val_dataset</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>batchsize</span> <span class=o>=</span> <span class=mi>16</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>collate</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>parallel</span> <span class=o>=</span> <span class=nb>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span></code></pre></div><h2 id=model-definition>Model Definition<a hidden class=anchor aria-hidden=true href=#model-definition>¶</a></h2><p>Here we will load the model with <code>Metalhead.jl</code> and change the classifier &ldquo;head&rdquo; of the architecture to suit our classification need.</p><p>We will use this to select the classifier head of the model and change it.</p><p>For the fine-tuning portion of this exercise will follow the <a href=https://github.com/FluxML/model-zoo/tree/master/tutorials%2Ftransfer_learning>model zoo documentation</a>:</p><hr><p><img loading=lazy src=/images/20240521_julia_transfer_learning_v5/109ebfef-0cea-49b5-98d5-fcd19f0f9596.png type alt=image.png></p><hr><p>Let&rsquo;s try it out with the <code>ResNet18</code> model.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># load the pre-trained model</span>
</span></span><span class=line><span class=cl><span class=n>resnet_model</span> <span class=o>=</span> <span class=n>ResNet</span><span class=p>(</span><span class=mi>18</span><span class=p>;</span> <span class=n>pretrain</span> <span class=o>=</span> <span class=nb>true</span><span class=p>)</span><span class=o>.</span><span class=n>layers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># let&#39;s look at the model</span>
</span></span><span class=line><span class=cl><span class=n>resnet_model</span>
</span></span></code></pre></div><pre><code>Chain(
  Chain(
    Chain(
      Conv((7, 7), 3 =&gt; 64, pad=3, stride=2, bias=false),  [90m# 9_408 parameters[39m
      BatchNorm(64, relu),              [90m# 128 parameters[39m[90m, plus 128[39m
      MaxPool((3, 3), pad=1, stride=2),
    ),
    Chain(
      Parallel(
        addact(NNlib.relu, ...),
        identity,
        Chain(
          Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
          BatchNorm(64),                [90m# 128 parameters[39m[90m, plus 128[39m
          NNlib.relu,
          Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
          BatchNorm(64),                [90m# 128 parameters[39m[90m, plus 128[39m
        ),
      ),
      Parallel(
        addact(NNlib.relu, ...),
        identity,
        Chain(
          Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
          BatchNorm(64),                [90m# 128 parameters[39m[90m, plus 128[39m
          NNlib.relu,
          Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
          BatchNorm(64),                [90m# 128 parameters[39m[90m, plus 128[39m
        ),
      ),
    ),
    Chain(
      Parallel(
        addact(NNlib.relu, ...),
        Chain(
          Conv((1, 1), 64 =&gt; 128, stride=2, bias=false),  [90m# 8_192 parameters[39m
          BatchNorm(128),               [90m# 256 parameters[39m[90m, plus 256[39m
        ),
        Chain(
          Conv((3, 3), 64 =&gt; 128, pad=1, stride=2, bias=false),  [90m# 73_728 parameters[39m
          BatchNorm(128),               [90m# 256 parameters[39m[90m, plus 256[39m
          NNlib.relu,
          Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
          BatchNorm(128),               [90m# 256 parameters[39m[90m, plus 256[39m
        ),
      ),
      Parallel(
        addact(NNlib.relu, ...),
        identity,
        Chain(
          Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
          BatchNorm(128),               [90m# 256 parameters[39m[90m, plus 256[39m
          NNlib.relu,
          Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
          BatchNorm(128),               [90m# 256 parameters[39m[90m, plus 256[39m
        ),
      ),
    ),
    Chain(
      Parallel(
        addact(NNlib.relu, ...),
        Chain(
          Conv((1, 1), 128 =&gt; 256, stride=2, bias=false),  [90m# 32_768 parameters[39m
          BatchNorm(256),               [90m# 512 parameters[39m[90m, plus 512[39m
        ),
        Chain(
          Conv((3, 3), 128 =&gt; 256, pad=1, stride=2, bias=false),  [90m# 294_912 parameters[39m
          BatchNorm(256),               [90m# 512 parameters[39m[90m, plus 512[39m
          NNlib.relu,
          Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
          BatchNorm(256),               [90m# 512 parameters[39m[90m, plus 512[39m
        ),
      ),
      Parallel(
        addact(NNlib.relu, ...),
        identity,
        Chain(
          Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
          BatchNorm(256),               [90m# 512 parameters[39m[90m, plus 512[39m
          NNlib.relu,
          Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
          BatchNorm(256),               [90m# 512 parameters[39m[90m, plus 512[39m
        ),
      ),
    ),
    Chain(
      Parallel(
        addact(NNlib.relu, ...),
        Chain(
          Conv((1, 1), 256 =&gt; 512, stride=2, bias=false),  [90m# 131_072 parameters[39m
          BatchNorm(512),               [90m# 1_024 parameters[39m[90m, plus 1_024[39m
        ),
        Chain(
          Conv((3, 3), 256 =&gt; 512, pad=1, stride=2, bias=false),  [90m# 1_179_648 parameters[39m
          BatchNorm(512),               [90m# 1_024 parameters[39m[90m, plus 1_024[39m
          NNlib.relu,
          Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
          BatchNorm(512),               [90m# 1_024 parameters[39m[90m, plus 1_024[39m
        ),
      ),
      Parallel(
        addact(NNlib.relu, ...),
        identity,
        Chain(
          Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
          BatchNorm(512),               [90m# 1_024 parameters[39m[90m, plus 1_024[39m
          NNlib.relu,
          Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
          BatchNorm(512),               [90m# 1_024 parameters[39m[90m, plus 1_024[39m
        ),
      ),
    ),
  ),
  Chain(
    AdaptiveMeanPool((1, 1)),
    MLUtils.flatten,
    Dense(512 =&gt; 1000),                 [90m# 513_000 parameters[39m
  ),
) [90m        # Total: 62 trainable arrays, [39m11_689_512 parameters,
[90m          # plus 40 non-trainable, 9_600 parameters, summarysize [39m44.654 MiB.
</code></pre><p>Now we modify the head, by chaning the last <code>Chain</code> in the model. We change the last layer to output 4 classes (as opposed to the original 1000 classes).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># modify the model</span>
</span></span><span class=line><span class=cl><span class=n>resnet_infer</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=n>resnet_model</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>resnet_tune</span> <span class=o>=</span> <span class=n>Chain</span><span class=p>(</span><span class=n>AdaptiveMeanPool</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)),</span> <span class=n>Flux</span><span class=o>.</span><span class=n>flatten</span><span class=p>,</span> <span class=n>Dense</span><span class=p>(</span><span class=mi>512</span> <span class=o>=&gt;</span> <span class=mi>4</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>Chain(
  AdaptiveMeanPool((1, 1)),
  Flux.flatten,
  Dense(512 =&gt; 4),                      [90m# 2_052 parameters[39m
) 
</code></pre><p><strong>And that&rsquo;s it!</strong> Now, let&rsquo;s just explore both portions of the model.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>resnet_infer</span>
</span></span></code></pre></div><pre><code>Chain(
  Chain(
    Conv((7, 7), 3 =&gt; 64, pad=3, stride=2, bias=false),  [90m# 9_408 parameters[39m
    BatchNorm(64, relu),                [90m# 128 parameters[39m[90m, plus 128[39m
    MaxPool((3, 3), pad=1, stride=2),
  ),
  Chain(
    Parallel(
      addact(NNlib.relu, ...),
      identity,
      Chain(
        Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
        BatchNorm(64),                  [90m# 128 parameters[39m[90m, plus 128[39m
        NNlib.relu,
        Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
        BatchNorm(64),                  [90m# 128 parameters[39m[90m, plus 128[39m
      ),
    ),
    Parallel(
      addact(NNlib.relu, ...),
      identity,
      Chain(
        Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
        BatchNorm(64),                  [90m# 128 parameters[39m[90m, plus 128[39m
        NNlib.relu,
        Conv((3, 3), 64 =&gt; 64, pad=1, bias=false),  [90m# 36_864 parameters[39m
        BatchNorm(64),                  [90m# 128 parameters[39m[90m, plus 128[39m
      ),
    ),
  ),
  Chain(
    Parallel(
      addact(NNlib.relu, ...),
      Chain(
        Conv((1, 1), 64 =&gt; 128, stride=2, bias=false),  [90m# 8_192 parameters[39m
        BatchNorm(128),                 [90m# 256 parameters[39m[90m, plus 256[39m
      ),
      Chain(
        Conv((3, 3), 64 =&gt; 128, pad=1, stride=2, bias=false),  [90m# 73_728 parameters[39m
        BatchNorm(128),                 [90m# 256 parameters[39m[90m, plus 256[39m
        NNlib.relu,
        Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
        BatchNorm(128),                 [90m# 256 parameters[39m[90m, plus 256[39m
      ),
    ),
    Parallel(
      addact(NNlib.relu, ...),
      identity,
      Chain(
        Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
        BatchNorm(128),                 [90m# 256 parameters[39m[90m, plus 256[39m
        NNlib.relu,
        Conv((3, 3), 128 =&gt; 128, pad=1, bias=false),  [90m# 147_456 parameters[39m
        BatchNorm(128),                 [90m# 256 parameters[39m[90m, plus 256[39m
      ),
    ),
  ),
  Chain(
    Parallel(
      addact(NNlib.relu, ...),
      Chain(
        Conv((1, 1), 128 =&gt; 256, stride=2, bias=false),  [90m# 32_768 parameters[39m
        BatchNorm(256),                 [90m# 512 parameters[39m[90m, plus 512[39m
      ),
      Chain(
        Conv((3, 3), 128 =&gt; 256, pad=1, stride=2, bias=false),  [90m# 294_912 parameters[39m
        BatchNorm(256),                 [90m# 512 parameters[39m[90m, plus 512[39m
        NNlib.relu,
        Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
        BatchNorm(256),                 [90m# 512 parameters[39m[90m, plus 512[39m
      ),
    ),
    Parallel(
      addact(NNlib.relu, ...),
      identity,
      Chain(
        Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
        BatchNorm(256),                 [90m# 512 parameters[39m[90m, plus 512[39m
        NNlib.relu,
        Conv((3, 3), 256 =&gt; 256, pad=1, bias=false),  [90m# 589_824 parameters[39m
        BatchNorm(256),                 [90m# 512 parameters[39m[90m, plus 512[39m
      ),
    ),
  ),
  Chain(
    Parallel(
      addact(NNlib.relu, ...),
      Chain(
        Conv((1, 1), 256 =&gt; 512, stride=2, bias=false),  [90m# 131_072 parameters[39m
        BatchNorm(512),                 [90m# 1_024 parameters[39m[90m, plus 1_024[39m
      ),
      Chain(
        Conv((3, 3), 256 =&gt; 512, pad=1, stride=2, bias=false),  [90m# 1_179_648 parameters[39m
        BatchNorm(512),                 [90m# 1_024 parameters[39m[90m, plus 1_024[39m
        NNlib.relu,
        Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
        BatchNorm(512),                 [90m# 1_024 parameters[39m[90m, plus 1_024[39m
      ),
    ),
    Parallel(
      addact(NNlib.relu, ...),
      identity,
      Chain(
        Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
        BatchNorm(512),                 [90m# 1_024 parameters[39m[90m, plus 1_024[39m
        NNlib.relu,
        Conv((3, 3), 512 =&gt; 512, pad=1, bias=false),  [90m# 2_359_296 parameters[39m
        BatchNorm(512),                 [90m# 1_024 parameters[39m[90m, plus 1_024[39m
      ),
    ),
  ),
) [90m        # Total: 60 trainable arrays, [39m11_176_512 parameters,
[90m          # plus 40 non-trainable, 9_600 parameters, summarysize [39m42.693 MiB.
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>resnet_tune</span>
</span></span></code></pre></div><pre><code>Chain(
  AdaptiveMeanPool((1, 1)),
  Flux.flatten,
  Dense(512 =&gt; 4),                      [90m# 2_052 parameters[39m
) 
</code></pre><h3 id=define-evaluation-and-training-functions>Define evaluation and training functions<a hidden class=anchor aria-hidden=true href=#define-evaluation-and-training-functions>¶</a></h3><p>Again, will follow the model zoo documentation. Small adaptations will be needed. (These two functions were taken directly from the documentation).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>function</span> <span class=n>eval_f</span><span class=p>(</span><span class=n>m_infer</span><span class=p>,</span> <span class=n>m_tune</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>good</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>in</span> <span class=n>val_loader</span>
</span></span><span class=line><span class=cl>        <span class=n>good</span> <span class=o>+=</span> <span class=n>sum</span><span class=p>(</span><span class=n>Flux</span><span class=o>.</span><span class=n>onecold</span><span class=p>(</span><span class=n>m_tune</span><span class=p>(</span><span class=n>m_infer</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span> <span class=o>.==</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>count</span> <span class=o>+=</span> <span class=n>length</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=n>acc</span> <span class=o>=</span> <span class=n>round</span><span class=p>(</span><span class=n>good</span> <span class=o>/</span> <span class=n>count</span><span class=p>,</span> <span class=n>digits</span> <span class=o>=</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>acc</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><pre><code>eval_f (generic function with 1 method)
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>function</span> <span class=n>train_epoch!</span><span class=p>(</span><span class=n>model_infer</span><span class=p>,</span> <span class=n>model_tune</span><span class=p>,</span> <span class=n>opt</span><span class=p>,</span> <span class=n>loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>in</span> <span class=n>loader</span>
</span></span><span class=line><span class=cl>        <span class=n>infer</span> <span class=o>=</span> <span class=n>model_infer</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>grads</span> <span class=o>=</span> <span class=n>gradient</span><span class=p>(</span><span class=n>model_tune</span><span class=p>)</span> <span class=k>do</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>            <span class=n>Flux</span><span class=o>.</span><span class=n>Losses</span><span class=o>.</span><span class=n>logitcrossentropy</span><span class=p>(</span><span class=n>m</span><span class=p>(</span><span class=n>infer</span><span class=p>),</span> <span class=n>Flux</span><span class=o>.</span><span class=n>onehotbatch</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=mi>1</span><span class=o>:</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>end</span>
</span></span><span class=line><span class=cl>        <span class=n>update!</span><span class=p>(</span><span class=n>opt</span><span class=p>,</span> <span class=n>model_tune</span><span class=p>,</span> <span class=n>grads</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><pre><code>train_epoch! (generic function with 1 method)
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>resnet_opt</span> <span class=o>=</span> <span class=n>Flux</span><span class=o>.</span><span class=n>setup</span><span class=p>(</span><span class=n>Flux</span><span class=o>.</span><span class=n>Optimisers</span><span class=o>.</span><span class=n>Adam</span><span class=p>(</span><span class=mf>1e-3</span><span class=p>),</span> <span class=n>resnet_tune</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>for</span> <span class=n>iter</span> <span class=o>=</span> <span class=mi>1</span><span class=o>:</span><span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=nd>@time</span> <span class=n>train_epoch!</span><span class=p>(</span><span class=n>resnet_infer</span><span class=p>,</span> <span class=n>resnet_tune</span><span class=p>,</span> <span class=n>resnet_opt</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metric_train</span> <span class=o>=</span> <span class=n>eval_f</span><span class=p>(</span><span class=n>resnet_infer</span><span class=p>,</span> <span class=n>resnet_tune</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metric_eval</span> <span class=o>=</span> <span class=n>eval_f</span><span class=p>(</span><span class=n>resnet_infer</span><span class=p>,</span> <span class=n>resnet_tune</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@info</span> <span class=s>&#34;train&#34;</span> <span class=n>metric</span> <span class=o>=</span> <span class=n>metric_train</span>
</span></span><span class=line><span class=cl>    <span class=nd>@info</span> <span class=s>&#34;eval&#34;</span> <span class=n>metric</span> <span class=o>=</span> <span class=n>metric_eval</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><pre><code>176.283332 seconds (37.11 M allocations: 98.153 GiB, 6.06% gc time, 143.87% compilation time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.5744
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.5455


 70.815518 seconds (2.42 M allocations: 95.936 GiB, 11.25% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.6823
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6273


 90.463025 seconds (2.42 M allocations: 95.936 GiB, 11.21% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.7032
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6455


 94.362892 seconds (2.42 M allocations: 95.936 GiB, 10.91% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.7433
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6727


116.526515 seconds (2.42 M allocations: 95.936 GiB, 9.62% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.7885
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6909
</code></pre><hr><h2 id=vision-transformers>Vision Transformers<a hidden class=anchor aria-hidden=true href=#vision-transformers>¶</a></h2><hr><p>Similar to the PyTorch demonstration, we can do transfer learning by changing a different computer vision model (Vision Transformer).</p><p>Let&rsquo;s get into it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>vit_model</span> <span class=o>=</span> <span class=n>ViT</span><span class=p>(</span><span class=ss>:base</span><span class=p>;</span> <span class=n>pretrain</span> <span class=o>=</span> <span class=nb>true</span><span class=p>)</span><span class=o>.</span><span class=n>layers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># let&#39;s have a look at the model head, to see how many inputs the head needs</span>
</span></span><span class=line><span class=cl><span class=n>vit_model</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span></code></pre></div><pre><code>Chain(
  LayerNorm(768),                       [90m# 1_536 parameters[39m
  Dense(768 =&gt; 1000),                   [90m# 769_000 parameters[39m
) [90m                  # Total: 4 arrays, [39m770_536 parameters, 2.940 MiB.
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=c># modify the head</span>
</span></span><span class=line><span class=cl><span class=n>vit_infer</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=n>vit_model</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># notice how we keep the input to the model head</span>
</span></span><span class=line><span class=cl><span class=n>vit_tune</span> <span class=o>=</span> <span class=n>Chain</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>LayerNorm</span><span class=p>(</span><span class=mi>768</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>Dense</span><span class=p>(</span><span class=mi>768</span> <span class=o>=&gt;</span> <span class=mi>4</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></div><pre><code>Chain(
  LayerNorm(768),                       [90m# 1_536 parameters[39m
  Dense(768 =&gt; 4),                      [90m# 3_076 parameters[39m
) [90m                  # Total: 4 arrays, [39m4_612 parameters, 18.352 KiB.
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=n>vit_opt</span> <span class=o>=</span> <span class=n>Flux</span><span class=o>.</span><span class=n>setup</span><span class=p>(</span><span class=n>Flux</span><span class=o>.</span><span class=n>Optimisers</span><span class=o>.</span><span class=n>Adam</span><span class=p>(</span><span class=mf>1e-3</span><span class=p>),</span> <span class=n>vit_tune</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>for</span> <span class=n>iter</span> <span class=o>=</span> <span class=mi>1</span><span class=o>:</span><span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=nd>@time</span> <span class=n>train_epoch!</span><span class=p>(</span><span class=n>vit_infer</span><span class=p>,</span> <span class=n>vit_tune</span><span class=p>,</span> <span class=n>vit_opt</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metric_train</span> <span class=o>=</span> <span class=n>eval_f</span><span class=p>(</span><span class=n>vit_infer</span><span class=p>,</span> <span class=n>vit_tune</span><span class=p>,</span> <span class=n>train_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>metric_eval</span> <span class=o>=</span> <span class=n>eval_f</span><span class=p>(</span><span class=n>vit_infer</span><span class=p>,</span> <span class=n>vit_tune</span><span class=p>,</span> <span class=n>val_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@info</span> <span class=s>&#34;train&#34;</span> <span class=n>metric</span> <span class=o>=</span> <span class=n>metric_train</span>
</span></span><span class=line><span class=cl>    <span class=nd>@info</span> <span class=s>&#34;eval&#34;</span> <span class=n>metric</span> <span class=o>=</span> <span class=n>metric_eval</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><pre><code>627.303072 seconds (17.32 M allocations: 291.924 GiB, 4.61% gc time, 3.66% compilation time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.7058
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6273


565.986959 seconds (2.54 M allocations: 291.028 GiB, 4.71% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.8042
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6273


516.041945 seconds (2.54 M allocations: 291.028 GiB, 4.92% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.866
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6818


515.415614 seconds (2.54 M allocations: 291.028 GiB, 4.80% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.8973
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6818


427.423410 seconds (2.54 M allocations: 291.028 GiB, 5.01% gc time)


[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39mtrain
[36m[1m└ [22m[39m  metric = 0.9199
[36m[1m┌ [22m[39m[36m[1mInfo: [22m[39meval
[36m[1m└ [22m[39m  metric = 0.6727
</code></pre><h3 id=save-the-models>Save the Models<a hidden class=anchor aria-hidden=true href=#save-the-models>¶</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>using</span> <span class=n>JLD2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>resnet_model_state</span> <span class=o>=</span> <span class=n>Flux</span><span class=o>.</span><span class=n>state</span><span class=p>(</span><span class=n>resnet_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vit_model_state</span> <span class=o>=</span> <span class=n>Flux</span><span class=o>.</span><span class=n>state</span><span class=p>(</span><span class=n>vit_model</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jldsave</span><span class=p>(</span><span class=s>&#34;resnet_model.jld2&#34;</span><span class=p>;</span> <span class=n>resnet_model_state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>jldsave</span><span class=p>(</span><span class=s>&#34;vit_model.jld2&#34;</span><span class=p>;</span> <span class=n>vit_model_state</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>[33m[1m┌ [22m[39m[33m[1mWarning: [22m[39mOpening file with JLD2.MmapIO failed, falling back to IOStream
[33m[1m└ [22m[39m[90m@ JLD2 C:\Users\ingvi\.julia\packages\JLD2\7uAqU\src\JLD2.jl:300[39m
[33m[1m┌ [22m[39m[33m[1mWarning: [22m[39mOpening file with JLD2.MmapIO failed, falling back to IOStream
[33m[1m└ [22m[39m[90m@ JLD2 C:\Users\ingvi\.julia\packages\JLD2\7uAqU\src\JLD2.jl:300[39m
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-julia data-lang=julia><span class=line><span class=cl><span class=k>using</span> <span class=n>BSON</span><span class=o>:</span> <span class=nd>@save</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@save</span> <span class=s>&#34;resnet_model_sate.bson&#34;</span> <span class=n>resnet_model</span>
</span></span><span class=line><span class=cl><span class=nd>@save</span> <span class=s>&#34;vit_model_state.bson&#34;</span> <span class=n>vit_model</span>
</span></span></code></pre></div><h2 id=thank-you>Thank you!<a hidden class=anchor aria-hidden=true href=#thank-you>¶</a></h2><p>I hope this demonstration on using Julia and <code>Flux</code> for transfer learning was helpful!</p><p>Victor</p></div><footer class=post-footer><nav class=paginav><a class=prev href=http://localhost:1313/posts/20240527_baylinreg_pymc/e01_baylinreg_pymc/><span class=title><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Bayesian Linear Regression with PyMC</span>
</a><a class=next href=http://localhost:1313/posts/20240515_cat_mood_classification/20240515_cat_mood_classification/><span class=title>Next Page&nbsp;<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Transfer Learning Classifier Using PyTorch</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Victor Flores, PhD</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>